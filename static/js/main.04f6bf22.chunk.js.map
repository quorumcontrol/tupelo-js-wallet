{"version":3,"sources":["components/establishtoken.tsx","components/sendtoken.tsx","components/minttoken.tsx","util/syncher.ts","components/receivetoken.tsx","components/tokenwallet.tsx","components/creator.tsx","components/objectwallet.tsx","pages/wallet.tsx","components/messagelist.tsx","App.tsx","serviceWorker.ts","index.tsx","pages/login.tsx","util/appcommunity.ts","state/store.tsx","../node_modules/tupelo-wasm-sdk/lib/js/go sync","util/usernames.ts"],"names":["EstablishTokenDialog","show","onClose","userTree","useState","loading","tokenName","maximum","state","setState","handleChange","evt","target","name","value","Card","style","backgroundColor","Head","Title","Body","Item","Field","Label","Control","Input","onChange","placeholder","type","toString","Help","kind","color","onClick","a","getAppCommunity","c","playTransactions","establishTokenTransaction","doAsync","text","SendTokenDialog","tokens","useContext","StoreContext","globalDispatch","destination","ammount","tokenOptions","Object","keys","map","key","Select","console","log","Promise","all","getUserTree","EcdsaKey","generate","destTree","ephemeralKey","ChainTree","newEmptyTree","blockservice","ephemeralTree","id","userDid","destDid","ephemeralDid","Error","resolve","userAuthResp","destAuthResp","sendId","Math","random","sendTx","sendTokenTransaction","parseInt","toObject","sendTokenAndGetPayload","payload","receiveTx","receiveTokenTransactionFromPayload","setOwnershipTransaction","concat","AppActions","message","title","body","MintTokenDialog","mintTokenTransaction","debug","SimpleSyncher","queue","started","this","undefined","queuedFn","pop","fn","resp","res","rej","length","run","reject","push","tokenPath","ReceiveTokenDialog","did","getTip","tip","tree","store","tokensResp","tResp","balance","syncher","token","send","sendPayloads","rxTransactions","s","TokenWallet","props","showEstablishModal","showMintModal","showSendModal","showReceiveModal","modifiedAt","globalState","useEffect","loadTokens","tokenResp","error","to","pathname","from","location","tokenRows","handleCloseModal","Date","now","Side","align","TokenRow","max","loadInfo","tokenInfoPath","tokenInfoResp","monetaryPolicy","ObjectCreator","subtitle","content","setLoading","ephemeralP","communityP","treeP","addrP","Tupelo","ecdsaPubkeyToAddress","publicKey","userAddr","nftP","setDataTransaction","userP","changeHandler","marginTop","createNFT","NFTCard","onSend","attrs","sending","resolveData","attrsResp","loadNFT","Header","Content","size","Footer","padding","ObjectWallet","dids","authResp","withoutSent","getObjects","cards","Column","onAdd","tabs","AddObjectForm","addOpen","addDid","addLoading","nftTip","nftTree","resolveResp","includes","Wallet","currentTab","objects","clickHandler","tabStr","innerText","toLowerCase","Tab","active","creator","tab","pageContent","UserMessageList","lis","messages","msg","position","right","zIndex","width","listStyleType","MessageElement","remove","removeMessage","Routing","className","height","path","App","transparent","Brand","Boolean","window","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","Actions","usernameTimeout","initialState","username","password","loadingText","checkUsername","dispatch","later","publicUserKey","ecdsaPubkeyToDid","clearTimeout","setTimeout","reducer","action","loginFormType","loginText","act","passwordFormType","registering","loggingIn","isAvailable","UsernameField","iconLeft","PasswordField","LoginBottom","onLogin","setPassword","setError","handleSubmit","passPhraseKey","Buffer","secureKey","secureAddr","RegisterBottom","passwordConfirm","setPasswordConfirm","insecureKey","secureKeyAddress","community","usernameKey","doRegister","LoginForm","useReducer","redirect","doRedirect","login","_appPromise","process","Community","getDefault","freshLocalTestCommunity","subDirectory","Go","setWasmPath","stopLoading","setDID","logout","sessionStorage","removeItem","index","i","slice","createContext","StoreProvider","children","firstRun","setFirstRun","getItem","userKey","fromBytes","doAsyncSet","privateKey","setItem","newState","Provider","webpackEmptyContext","req","e","code","module","exports","namespace","userName","didFromUserName","userTip"],"mappings":"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","file":"static/js/main.04f6bf22.chunk.js","sourcesContent":["import React, { useState } from 'react'\n\nimport { Modal, Form, Button, Media,Content, Loader } from 'react-bulma-components'\nimport { ChainTree, establishTokenTransaction } from 'tupelo-wasm-sdk'\nimport { getAppCommunity } from '../util/appcommunity'\n\nexport function EstablishTokenDialog({ show, onClose, userTree }: { userTree: ChainTree, show: boolean, onClose: (() => void) }) {\n    const [state, setState] = useState({\n        loading: false,\n        tokenName: '',\n        maximum: 0,\n    })\n\n    const handleChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        setState({ ...state, [evt.target.name]: evt.target.value })\n    }\n\n    const handleSubmit = () => {\n        setState({...state, loading: true})\n        const doAsync = async ()=> {\n            const c = await getAppCommunity()\n            await c.playTransactions(userTree, [establishTokenTransaction(state.tokenName, state.maximum)])\n            setState({...state, loading: false, tokenName: '', maximum: 0})\n            onClose()\n        }\n        doAsync()\n    }\n\n    return (\n    <Modal show={show} onClose={onClose}>\n        <Modal.Card style={{backgroundColor: 'white'}}>\n        <Modal.Card.Head>\n            <Modal.Card.Title>\n                Establish Token\n            </Modal.Card.Title>\n        </Modal.Card.Head>\n        <Modal.Card.Body>\n            <Media>\n                {state.loading ?\n                <Loader />\n                :                \n                <Media.Item>\n                    <Content>\n                        <Form.Field>\n                            <Form.Label>Token Name</Form.Label>\n                            <Form.Control>\n                                <Form.Input value={state.tokenName} onChange={handleChange} name=\"tokenName\" placeholder=\"Token Name\" />\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field>\n                            <Form.Label>Maximum Mint</Form.Label>\n                            <Form.Control>\n                                <Form.Input type=\"number\" value={state.maximum.toString()} onChange={handleChange} name=\"maximum\" placeholder=\"Maximum Mint\" />\n                            </Form.Control>\n                            <Form.Help>Leave as 0 to allow unlimited minting</Form.Help>\n                        </Form.Field>\n                        <Form.Field kind=\"group\">\n                            <Button color=\"primary\" onClick={handleSubmit}>Establish</Button>\n                            <Button text onClick={() => { onClose() }}>cancel</Button>\n                        </Form.Field>\n                    </Content>\n                </Media.Item>\n                }\n            </Media>\n        </Modal.Card.Body>\n        </Modal.Card>\n    </Modal>\n)\n}\n\n","import React, { useState, useContext } from 'react'\n\nimport { Modal, Form, Button, Media,Content, Loader } from 'react-bulma-components'\nimport { ChainTree, receiveTokenTransactionFromPayload, EcdsaKey, sendTokenTransaction, setOwnershipTransaction } from 'tupelo-wasm-sdk'\nimport { getAppCommunity } from '../util/appcommunity'\nimport { getUserTree } from '../util/usernames'\nimport { StoreContext, IAppMessage, AppActions } from '../state/store'\n\n//TODO: this would be nice with error handling, etc\n\n//TODO(bug): if you let the browser autofill a field it doesn't trigger change and so it doesn't update the state\n// so you end up with null names\n\nexport function SendTokenDialog({ show, onClose, userTree, tokens }: { tokens: Object, userTree: ChainTree, show: boolean, onClose: (() => void) }) {\n    const [,globalDispatch] = useContext(StoreContext)\n    \n    const [state, setState] = useState({\n        loading: false,\n        tokenName: '',\n        destination: '',\n        ammount: '',\n    })\n\n    const handleChange = (evt: React.ChangeEvent<HTMLInputElement|HTMLSelectElement>) => {\n        setState({ ...state, [evt.target.name]: evt.target.value })\n    }\n\n    const handleSubmit = () => {\n        setState({...state, loading: true})\n        const doAsync = async ()=> {\n            console.log(\"sending: \", state)\n            /*\n                get destination chain,\n                create a new ephemeral chaintree\n                chown owner to both self and destination\n                sendCoin from user tree\n                receiveCoin on new chaintree\n            */\n            const c = await getAppCommunity()\n            \n            const [destTree, ephemeralKey] = await Promise.all([getUserTree(state.destination), EcdsaKey.generate()])\n            const ephemeralTree = await ChainTree.newEmptyTree(c.blockservice, ephemeralKey)\n\n            const userDid = await userTree.id()\n            const destDid = await destTree.id()\n            const ephemeralDid = await ephemeralTree.id()\n\n            if (userDid === null || destDid === null || ephemeralDid === null) {\n                throw new Error(\"error getting userdid, destdid or ephemeralDID\")\n            }\n\n            console.log(\"ephemeralDID: \", ephemeralDid)\n            const userAuthResp = await userTree.resolve(\"tree/_tupelo/authentications\")\n            const destAuthResp = await destTree.resolve(\"tree/_tupelo/authentications\")\n\n            const sendId = userDid + \"->\" + destDid + Math.random().toString()\n\n            console.log(\"sending token to ephemeral\")\n            const sendTx = sendTokenTransaction(\n                sendId,\n                state.tokenName,\n                parseInt(state.ammount, 10),\n                ephemeralDid,\n            )\n            console.log(\"send tx: \", sendTx.toObject())\n            const payload = await c.sendTokenAndGetPayload(userTree, sendTx)\n\n            console.log(\"receiving on ephemeral, payload: \", payload.toObject())\n            let receiveTx = receiveTokenTransactionFromPayload(payload)\n\n            console.log(\"receiveTx: \", receiveTx.toObject())\n            await c.playTransactions(ephemeralTree, [\n                setOwnershipTransaction(userAuthResp.value.concat(destAuthResp.value)),\n                receiveTx,\n            ])\n            console.log('done')\n            \n            setState({...state, loading: false, tokenName: '', destination: '', ammount: ''})\n            onClose()\n            globalDispatch({\n                type: AppActions.message,\n                message: {\n                    title: \"Sent!\",\n                    body: \"Tell \" + state.destination + \" to use this: \" + ephemeralDid, \n                }\n            } as IAppMessage)\n        }\n        doAsync()\n    }\n\n    const tokenOptions = Object.keys(tokens).map((tokenName) => {\n        return <option key={tokenName} value={tokenName}>{tokenName}</option>\n    })\n\n    return (\n    <Modal show={show} onClose={onClose}>\n        <Modal.Card style={{backgroundColor: 'white'}}>\n        <Modal.Card.Head>\n            <Modal.Card.Title>\n                Send Token\n            </Modal.Card.Title>\n        </Modal.Card.Head>\n        <Modal.Card.Body>\n            <Media>\n                {state.loading ?\n                <Loader />\n                :                \n                <Media.Item>\n                    <Content>\n                        <Form.Field>\n                            <Form.Label>Token Name</Form.Label>\n                            <Form.Control>\n                                <Form.Select onChange={handleChange} value={state.tokenName} name=\"tokenName\">\n                                    <option value=\"\"></option>\n                                    {tokenOptions}\n                                </Form.Select>\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field>\n                            <Form.Label>Destination</Form.Label>\n                            <Form.Control>\n                                <Form.Input value={state.destination} onChange={handleChange} name=\"destination\" placeholder=\"Where to send\" />\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field>\n                            <Form.Label>Ammount</Form.Label>\n                            <Form.Control>\n                                <Form.Input type=\"number\" value={state.ammount.toString()} onChange={handleChange} name=\"ammount\" placeholder=\"Ammount to send\" />\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field kind=\"group\">\n                            <Button color=\"primary\" onClick={handleSubmit}>Send</Button>\n                            <Button text onClick={() => { onClose() }}>cancel</Button>\n                        </Form.Field>\n                    </Content>\n                </Media.Item>\n                }\n            </Media>\n        </Modal.Card.Body>\n        </Modal.Card>\n    </Modal>\n)\n}\n\n","import React, { useState } from 'react'\n\nimport { Modal, Form, Button, Media,Content, Loader } from 'react-bulma-components'\nimport { ChainTree, mintTokenTransaction } from 'tupelo-wasm-sdk'\nimport { getAppCommunity } from '../util/appcommunity'\n\n//TODO: this would be nice with error handling to show you you're trying to mint more than the allowed\n\nexport function MintTokenDialog({ show, onClose, userTree, tokens }: { tokens: Object, userTree: ChainTree, show: boolean, onClose: (() => void) }) {\n    const [state, setState] = useState({\n        loading: false,\n        tokenName: '',\n        ammount: 0,\n    })\n\n    const handleChange = (evt: React.ChangeEvent<HTMLInputElement|HTMLSelectElement>) => {\n        setState({ ...state, [evt.target.name]: evt.target.value })\n    }\n\n    const handleSubmit = () => {\n        setState({...state, loading: true})\n        const doAsync = async ()=> {\n            const c = await getAppCommunity()\n            await c.playTransactions(userTree, [mintTokenTransaction(state.tokenName, state.ammount)])\n            setState({...state, loading: false, tokenName: '', ammount: 0})\n            onClose()\n        }\n        doAsync()\n    }\n\n    const tokenOptions = Object.keys(tokens).map((tokenName) => {\n        return <option key={tokenName} value={tokenName}>{tokenName}</option>\n    })\n\n    return (\n    <Modal show={show} onClose={onClose}>\n        <Modal.Card style={{backgroundColor: 'white'}}>\n        <Modal.Card.Head>\n            <Modal.Card.Title>\n                Mint Token\n            </Modal.Card.Title>\n        </Modal.Card.Head>\n        <Modal.Card.Body>\n            <Media>\n                {state.loading ?\n                <Loader />\n                :                \n                <Media.Item>\n                    <Content>\n                        <Form.Field>\n                            <Form.Label>Token Name</Form.Label>\n                            <Form.Control>\n                                <Form.Select onChange={handleChange} value={state.tokenName} name=\"tokenName\">\n                                    <option value=\"\"></option>\n                                    {tokenOptions}\n                                </Form.Select>\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field>\n                            <Form.Label>Ammount</Form.Label>\n                            <Form.Control>\n                                <Form.Input type=\"number\" value={state.ammount.toString()} onChange={handleChange} name=\"ammount\" placeholder=\"Ammount to Mint\" />\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field kind=\"group\">\n                            <Button color=\"primary\" onClick={handleSubmit}>Mint</Button>\n                            <Button text onClick={() => { onClose() }}>cancel</Button>\n                        </Form.Field>\n                    </Content>\n                </Media.Item>\n                }\n            </Media>\n        </Modal.Card.Body>\n        </Modal.Card>\n    </Modal>\n)\n}\n\n","import debug from 'debug'\n\nconst log = debug(\"util:syncher\")\n\ninterface queuedFunction {\n    fn:Function\n    res:Function\n    rej:Function\n}\n\n/**\n * SimpleActor is used to serialize function calls, it is a single threaded\n * actor that does one function after the next. Every send returns a promise\n * that is executed after the serialization\n */\nexport class SimpleSyncher {\n    private queue:queuedFunction[]\n    private started:boolean\n    private name?:string\n    constructor(name?:string) {\n        this.started = false\n        this.queue = []\n        this.name = name\n    }\n\n    private async run() {\n        const queuedFn = this.queue.pop()\n        if (queuedFn === undefined) {\n            log(this.name, ' stopping syncher')\n            this.started = false\n            return\n        }\n        try {\n            log(this.name, ' run fn', queuedFn.fn.toString())\n            const resp = await queuedFn.fn()\n            log(this.name, ' finish fn')\n            queuedFn.res(resp)\n        } catch(err) {\n            log(this.name, ' rejecting: ', err)\n            queuedFn.rej(err)\n        }\n        if (this.queue.length > 0) {\n            log(this.name, \"syncher queueing another\")\n            this.run()\n        } else {\n            this.started = false\n        }\n    }\n\n    send(fn:Function) {\n        const p = new Promise((resolve,reject) => {\n            this.queue.push({\n                fn:fn,\n                res: resolve,\n                rej:reject,\n            })\n            if (!this.started) {\n                log(this.name, \" not started, starting\")\n                this.started = true\n                this.run()\n                return\n            }\n            log(this.name, ' run already started')\n        })\n       \n        return p\n    }\n\n\n}","import React, { useState } from 'react'\n\nimport { Modal, Form, Button, Media, Content, Loader } from 'react-bulma-components'\nimport { ChainTree, receiveTokenTransactionFromPayload, sendTokenTransaction } from 'tupelo-wasm-sdk'\nimport { getAppCommunity } from '../util/appcommunity'\nimport { SimpleSyncher } from '../util/syncher'\nimport { TokenPayload } from 'tupelo-messages'\n\n\nconst tokenPath = \"/tree/_tupelo/tokens\";\n\n//TODO: this would be nice with error handling, etc\n\nexport function ReceiveTokenDialog({ show, onClose, userTree }: { userTree: ChainTree, show: boolean, onClose: (() => void) }) {\n\n    const [state, setState] = useState({\n        loading: false,\n        did: '',\n    })\n\n    const handleChange = (evt: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n        setState({ ...state, [evt.target.name]: evt.target.value })\n    }\n\n    const handleSubmit = () => {\n        setState({ ...state, loading: true })\n        const doAsync = async () => {\n            const c = await getAppCommunity()\n\n            const userDid = await userTree.id()\n            if (userDid === null) {\n                throw new Error(\"user tree had null id\")\n            }\n            const tip = await c.getTip(state.did)\n            const tree = new ChainTree({\n                store: c.blockservice,\n                tip: tip,\n                key: userTree.key,\n            })\n            const tokensResp = await tree.resolve(tokenPath)\n            const tokens = await Promise.all(Object.keys(tokensResp.value || {}).map(async (key) => {\n                const tResp = await tree.resolve(tokenPath + \"/\" + key)\n                return {\n                    name: key,\n                    balance: tResp.value['balance'],\n                }\n            }));\n\n            const syncher = new SimpleSyncher()\n            const sendPayloads = await Promise.all(tokens.map((token) => {\n                return syncher.send(() => {\n                    return c.sendTokenAndGetPayload(tree, sendTokenTransaction(\"uuid\" + Math.random().toString(), token.name, token.balance, userDid))\n                })\n            })) as TokenPayload[]\n            const rxTransactions = sendPayloads.map((payload) => {\n                return receiveTokenTransactionFromPayload(payload)\n            })\n            await c.playTransactions(userTree, rxTransactions)\n            setState((s) => {\n                return { ...s, loading: false, did: '' }\n            })\n            onClose()\n        }\n        doAsync()\n    }\n\n    return (\n        <Modal show={show} onClose={onClose}>\n            <Modal.Card style={{ backgroundColor: 'white' }}>\n                <Modal.Card.Head>\n                    <Modal.Card.Title>\n                        Receive Token\n            </Modal.Card.Title>\n                </Modal.Card.Head>\n                <Modal.Card.Body>\n                    <Media>\n                        {state.loading ?\n                            <Loader />\n                            :\n                            <Media.Item>\n                                <Content>\n                                    <Form.Field>\n                                        <Form.Label>DID</Form.Label>\n                                        <Form.Control>\n                                            <Form.Input value={state.did} onChange={handleChange} name=\"did\" placeholder=\"DID of tokens\" />\n                                        </Form.Control>\n                                        <Form.Help>\n                                            This is the code that begins with 'did:tupelo:' that the sender has from the wallet.å\n                            </Form.Help>\n                                    </Form.Field>\n                                    <Form.Field kind=\"group\">\n                                        <Button color=\"primary\" onClick={handleSubmit}>Receive</Button>\n                                        <Button text onClick={() => { onClose() }}>cancel</Button>\n                                    </Form.Field>\n                                </Content>\n                            </Media.Item>\n                        }\n                    </Media>\n                </Modal.Card.Body>\n            </Modal.Card>\n        </Modal>\n    )\n}\n\n","import React, { useContext, useState, useEffect } from 'react'\nimport { StoreContext } from '../state/store'\nimport { Redirect, RouteProps } from 'react-router'\nimport { Table, Loader, Button, Level } from 'react-bulma-components'\nimport { EstablishTokenDialog } from './establishtoken';\nimport { SendTokenDialog } from './sendtoken';\nimport { ChainTree } from 'tupelo-wasm-sdk'\nimport { MintTokenDialog } from './minttoken';\nimport { ReceiveTokenDialog } from './receivetoken';\n\nconst tokenPath = \"/tree/_tupelo/tokens\";\n\n\nexport function TokenWallet(props: RouteProps) {\n\n    const [state, setState] = useState({\n        loading: true,\n        tokens: {},\n        showEstablishModal: false,\n        showMintModal: false,\n        showSendModal: false,\n        showReceiveModal: false,\n        modifiedAt: 0,\n    })\n\n    const [globalState] = useContext(StoreContext)\n\n    useEffect(() => {\n        const loadTokens = async () => {\n            if (globalState.userTree === undefined) {\n                throw new Error(\"user tree must be defined\")\n            }\n            let tokenResp: any\n            try {\n                tokenResp = await globalState.userTree.resolve(tokenPath)\n            } catch (e) {\n                console.error(\"e: \", e)\n                setState((s) => {\n                    return { ...s, tokens: {}, loading: false }\n                })\n            }\n\n            console.log(\"tokens resp: \", tokenResp)\n            setState((s) => {\n                return { ...s, tokens: (tokenResp.value || {}), loading: false }\n            })\n        }\n\n        console.log(\"loading tokens\")\n        loadTokens()\n        \n    }, [globalState.userTree, state.modifiedAt])\n\n    if (!globalState.userTree) {\n        return (\n            <Redirect to={{\n                pathname: \"/login\",\n                state: { from: props.location },\n            }} />\n        )\n    }\n\n    if (state.loading) {\n        return <Loader />\n    }\n\n    const tokenRows = Object.keys(state.tokens).map((tokenName) => {\n        if (globalState.userTree === undefined) {\n            throw new Error(\"undefined user tree!\")\n        }\n        return <TokenRow key={tokenName} modifiedAt={state.modifiedAt} tree={globalState.userTree} tokenName={tokenName} />\n    })\n\n    const handleCloseModal = ()=> {\n        console.log(\"setting modifiedAt\")\n        setState((s) => {return {...s, modifiedAt: Date.now()}})\n    }\n\n    return (\n        <div>\n            <EstablishTokenDialog userTree={globalState.userTree} show={state.showEstablishModal} onClose={() => { handleCloseModal(); setState({ ...state, showEstablishModal: false }) }} />\n            <MintTokenDialog tokens={state.tokens} userTree={globalState.userTree} show={state.showMintModal} onClose={() => { handleCloseModal(); setState({ ...state, showMintModal: false }) }} />\n            <SendTokenDialog tokens={state.tokens} userTree={globalState.userTree} show={state.showSendModal} onClose={() => { handleCloseModal(); setState({ ...state, showSendModal: false }) }} />\n            <ReceiveTokenDialog userTree={globalState.userTree} show={state.showReceiveModal} onClose={() => { handleCloseModal(); setState({ ...state, showReceiveModal: false }) }} />\n            <Level>\n                <Level.Side align=\"left\">\n                    <Level.Item>\n                        <Button onClick={() => { setState({ ...state, showEstablishModal: true }) }}>Establish Token</Button>\n                    </Level.Item>\n                    <Level.Item>\n                        <Button onClick={() => { setState({ ...state, showMintModal: true }) }}>Mint Token</Button>\n                    </Level.Item>\n                    <Level.Item>\n                        <Button onClick={() => { setState({ ...state, showSendModal: true }) }}>Send Token</Button>\n                    </Level.Item>\n                    <Level.Item>\n                        <Button onClick={() => { setState({ ...state, showReceiveModal: true }) }}>Receive Token</Button>\n                    </Level.Item>\n                </Level.Side>\n            </Level>\n            <Table>\n                <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Balance</th>\n                        <th>Max</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {tokenRows}\n                </tbody>\n            </Table>\n        </div>\n    )\n}\n\n\nexport const TokenRow = ({ tree, tokenName, modifiedAt }: { modifiedAt: number, tree: ChainTree, tokenName: string }) => {\n    const [state, setState] = useState({\n        balance: 0,\n        max: null,\n        loading: true,\n    })\n\n    useEffect(() => {\n        const loadInfo = async () => {\n            const tokenInfoPath = tokenPath + \"/\" + tokenName\n            const tokenInfoResp = await tree.resolve(tokenInfoPath)\n            console.log(\"tokenInfoResp \", tokenInfoPath, tokenInfoResp)\n            if (tokenInfoResp.value.monetaryPolicy) {\n                const monetaryPolicy = await tree.resolve(tokenInfoPath + \"/monetaryPolicy\")\n                setState((s) => { return { ...s, max: monetaryPolicy.value['maximum'] } })\n            }\n\n            setState((s) => {\n                return { ...s, balance: tokenInfoResp.value['balance'], loading: false }\n            })\n        }\n        console.log(\"loading tokenRow\")\n        loadInfo()\n    }, [tree, tokenName, modifiedAt])\n\n    return (\n        <tr>\n            <td>\n                {tokenName}\n            </td>\n            <td>\n                {state.loading ? <Loader /> : state.balance}\n            </td>\n            <td>\n                {state.loading ? <Loader /> : state.max}\n            </td>\n        </tr>\n    )\n}","import React, { useState } from 'react';\nimport { Heading, Form, Box,Button, Loader } from 'react-bulma-components';\nimport { Tupelo,ChainTree, EcdsaKey, setDataTransaction, setOwnershipTransaction } from 'tupelo-wasm-sdk';\nimport { getAppCommunity } from '../util/appcommunity';\n\nexport interface INFTProperties {\n    title: string\n    subtitle: string\n    content: string\n}\n\nexport function ObjectCreator({userTree}:{userTree:ChainTree}) {\n    const [state, setState] = useState({\n        title: \"\",\n        subtitle: \"\",\n        content: \"\",\n    } as { [index: string]: string })\n\n    const [loading,setLoading] = useState(false)\n\n    async function createNFT() {\n        const props = state\n        if (userTree.key === undefined) {\n            throw new Error(\"undefined userTree key\")\n        }\n        // first we create an ephemeral key\n        const ephemeralP = EcdsaKey.generate()\n        const communityP = getAppCommunity()\n    \n        const [ephemeralKey,c] = await Promise.all([ephemeralP,communityP])\n        // then a new chaintree\n        const treeP = ChainTree.newEmptyTree(c.blockservice, ephemeralKey)\n        const addrP = Tupelo.ecdsaPubkeyToAddress(userTree.key.publicKey)\n        const [tree,userAddr] = await Promise.all([treeP, addrP])\n        const did = await tree.id()\n        if (did === null) {\n            throw new Error(\"unknown tree DID\")\n        }\n        // now we set the data and CHOWN to the user\n        const nftP = c.playTransactions(tree, [\n            setDataTransaction(\"/_wallet/attributes\", {\n                title: props.title,\n                subtitle: props.subtitle,\n                content: props.content\n            }),\n            setOwnershipTransaction([userAddr]),\n        ])\n        // and we keep a record of the NFT in the user tree\n        const userP = c.playTransactions(userTree, [\n            setDataTransaction(\"/_wallet/nfts/\" + did, Date.now())\n        ])\n        await Promise.all([nftP, userP])\n        setState({})\n        setLoading(false)\n    }\n\n    const changeHandler = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        const target = evt.target\n        setState({...state,\n            [target.name]: target.value,\n        })\n    }\n\n    const submitHandler = ()=> {\n        setLoading(true)\n        createNFT()\n    }\n\n    return (\n        <div>\n            <Heading>Object Creator</Heading>\n            <p>This lets you create an NFT!</p>\n            {loading ?\n            <Loader/> \n        :\n            <Box style={{ marginTop: '1em' }}>\n                <Form.Field>\n                    <Form.Label>Title</Form.Label>\n                    <Form.Control>\n                        <Form.Input value={state.title} onChange={changeHandler} name=\"title\" placeholder=\"title\" />\n                    </Form.Control>\n                </Form.Field>\n                <Form.Field>\n                    <Form.Label>Subtitle</Form.Label>\n                    <Form.Control>\n                        <Form.Input value={state.subtitle} onChange={changeHandler} name=\"subtitle\" placeholder=\"subtitle\" />\n                    </Form.Control>\n                </Form.Field>\n                <Form.Field>\n                    <Form.Label>Content</Form.Label>\n                    <Form.Control>\n                        <Form.Input value={state.content} onChange={changeHandler} name=\"content\" placeholder=\"content\" />\n                    </Form.Control>\n                </Form.Field>\n                <Button onClick={submitHandler}>Create</Button>\n            </Box>}\n        </div>\n    )\n}","import React, { useContext, useState, useEffect } from 'react';\nimport { Box, Button, Form, Media, Card, Heading, Content, Loader, Columns } from 'react-bulma-components';\nimport { StoreContext } from '../state/store';\nimport { ChainTree, Tupelo, setOwnershipTransaction, setDataTransaction } from 'tupelo-wasm-sdk';\nimport { getAppCommunity } from '../util/appcommunity';\nimport { INFTProperties } from './creator';\nimport { getUserTree } from '../util/usernames';\n\ninterface IOnSendEvent {\n    did: string\n    tree: ChainTree\n    destination: string\n}\n\n\nfunction NFTCard({ did, onSend }: { did: string, onSend: Function }) {\n    const [state, setState] = useState({\n        loading: true,\n        tree: undefined as ChainTree | undefined,\n        attrs: {} as INFTProperties,\n        sending: false,\n        destination: \"\",\n    })\n\n\n    useEffect(() => {\n        const loadNFT = async () => {\n            const c = await getAppCommunity()\n            const tip = await c.getTip(did)\n            const tree = new ChainTree({\n                store: c.blockservice,\n                tip: tip,\n            })\n            const attrsResp = await tree.resolveData(\"/_wallet/attributes\")\n            setState((s) => {\n                return { ...s, loading: false, tree: tree, attrs: (attrsResp.value || {}) }\n            })\n        }\n\n        loadNFT()\n    }, [did])\n\n    const handleChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        setState({ ...state, destination: evt.target.value })\n    }\n\n    const handleSend = () => {\n        setState({ ...state, loading: true, sending: false })\n        onSend({\n            did: did,\n            tree: state.tree,\n            destination: state.destination,\n        } as IOnSendEvent)\n    }\n\n    return (\n        <Card>\n            <Card.Header>\n                <Card.Header.Title>{state.attrs.title}</Card.Header.Title>\n            </Card.Header>\n            <Card.Content>\n                {state.loading ?\n                    <Loader />\n                    :\n                    <div>\n                        <Media>\n                            <Media.Item>\n                                <Heading size={4}>\n                                    {state.attrs.title}\n                                </Heading>\n                                <Heading subtitle size={6}>\n                                    {state.attrs.subtitle}\n                                </Heading>\n                            </Media.Item>\n                        </Media>\n                        <Content>\n                            {state.attrs.content}\n                            <p>{did}</p>\n                        </Content>\n                    </div>}\n            </Card.Content>\n            <Card.Footer>\n                {!state.sending ?\n                    <Card.Footer.Item>\n                        <Button onClick={() => { setState({ ...state, sending: true }) }}>Send</Button>\n                    </Card.Footer.Item>\n                    :\n                    <Content style={{ padding: '1em' }}>\n                        <Form.Field>\n                            <Form.Label>Destination Name</Form.Label>\n                            <Form.Control>\n                                <Form.Input value={state.destination} onChange={handleChange} name=\"nftdestination\" placeholder=\"Destination\" />\n                            </Form.Control>\n                        </Form.Field>\n                        <Form.Field kind=\"group\">\n                            <Button color=\"primary\" onClick={handleSend}>Send</Button>\n                            <Button text onClick={() => { setState({ ...state, sending: false, destination: \"\" }) }}>cancel</Button>\n                        </Form.Field>\n                    </Content>\n                }\n            </Card.Footer>\n        </Card>\n    )\n}\n\nexport function ObjectWallet() {\n\n    const [globalState] = useContext(StoreContext)\n    const [state, setState] = useState({\n        dids: {} as { [index: string]: number },\n    })\n\n    if (globalState.userTree === undefined) {\n        throw new Error(\"must have a userTree to use ObjectWallet\")\n    }\n\n    const onSend = async (evt: IOnSendEvent) => {\n        const userTree = globalState.userTree\n        if (userTree === undefined || userTree.key === undefined) {\n            throw new Error(\"can only send when a valid user\")\n        }\n        const c = await getAppCommunity()\n\n        const destTree = await getUserTree(evt.destination)\n        const authResp = await destTree.resolve(\"tree/_tupelo/authentications\")\n\n        evt.tree.key = userTree.key\n        console.log(\"reassigning \", evt.did, \" to: \", evt.destination)\n        // set the auth of this NFT to the same as the receiver\n        await c.playTransactions(evt.tree, [\n            setOwnershipTransaction(authResp.value)\n        ])\n\n        console.log('remove did from nfts')\n        // remove this NFT from my bag of hodling\n        const { [evt.did]: value, ...withoutSent } = state.dids\n        await c.playTransactions(userTree, [\n            setDataTransaction(\"/_wallet/nfts\", withoutSent)\n        ])\n        setState((s) => {\n            return { ...s, dids: withoutSent }\n        })\n    }\n\n    useEffect(() => {\n        const getObjects = async () => {\n            if (globalState.userTree === undefined) {\n                throw new Error(\"user tree has to be defined\")\n            }\n            const tResp = await globalState.userTree.resolveData(\"/_wallet/nfts\")\n            setState((s) => {\n                return { ...s, dids: (tResp.value || {}) }\n            })\n        }\n\n        if (globalState.userTree) {\n            getObjects()\n        }\n    }, [globalState.userTree])\n\n    const cards = Object.keys(state.dids).map((did) => {\n        return (\n            <Columns.Column key={did} size=\"half\">\n                <NFTCard onSend={onSend} did={did} />\n            </Columns.Column>\n        )\n    })\n\n    const handleAdd = function(did:string) {\n        setState((s) => {\n            return {...s, dids: {...state.dids, [did]: Date.now()}}\n        })\n    }\n\n    return (\n        <div>\n            <Heading>Object wallet</Heading>\n            <Columns>\n                {cards}\n            </Columns>\n            <AddObjectForm onAdd={handleAdd} userTree={globalState.userTree} />\n        </div>\n    )\n}\n\nconst AddObjectForm = ({ userTree, onAdd }: { userTree: ChainTree, onAdd:Function }) => {\n    const [state, setState] = useState({\n        addOpen: false,\n        addDid: \"\",\n        addLoading: false,\n    })\n\n    const handleAdd = () => {\n        setState({ ...state, addLoading: true })\n        const did = state.addDid\n        const doAsync = async () => {\n            if (userTree === undefined || userTree.key === undefined) {\n                throw new Error(\"user tree undfined\")\n            }\n\n            const c = await getAppCommunity()\n            const nftTip = await c.getTip(did)\n            const nftTree = new ChainTree({\n                store: c.blockservice,\n                tip: nftTip,\n            })\n            let userAddr = await Tupelo.ecdsaPubkeyToAddress(userTree.key.publicKey)\n            let resolveResp = await nftTree.resolve(\"tree/_tupelo/authentications\")\n            let auths: string[] = resolveResp.value\n            if (auths.includes(userAddr)) {\n                // this tree does belong to the user\n                await c.playTransactions(userTree, [\n                    setDataTransaction(\"/_wallet/nfts/\" + did, Date.now())\n                ])\n                onAdd(did)\n                setState({ ...state, addLoading: false, addDid: \"\" })\n            }\n            setState({ ...state, addLoading: false, addDid: \"\",addOpen: false })\n        }\n        doAsync()\n    }\n\n    return (\n        <div>\n            {state.addOpen ?\n                <Box>\n                    <Form.Field>\n                        <Form.Label>Add</Form.Label>\n                        <Form.Control>\n                            <Form.Input value={state.addDid} onChange={(evt) => { setState({ ...state, addDid: evt.target.value }) }} name=\"additionalDid\" placeholder=\"DID\" />\n                        </Form.Control>\n                    </Form.Field>\n                    <Form.Field kind=\"group\">\n                        <Button onClick={handleAdd} color=\"primary\">Add</Button>\n                        <Button text onClick={() => { setState((s) => { return { ...s, addOpen: false, addDid: '' } }) }}>Cancel</Button>\n                    </Form.Field>\n                </Box>\n                :\n                <Button onClick={() => { setState((s) => { return { ...s, addOpen: true } }) }}>Add</Button>\n            }\n        </div>\n    )\n}","import React, { useContext, useState } from 'react';\nimport { StoreContext } from '../state/store';\nimport { Redirect, RouteProps } from 'react-router';\nimport { Tabs, Container, Heading } from 'react-bulma-components';\nimport { TokenWallet } from '../components/tokenwallet';\nimport { ObjectCreator } from '../components/creator';\nimport { ObjectWallet } from '../components/objectwallet';\n\nenum tabs {\n    objects,\n    tokens,\n    creator,\n}\ntype tabStrings = keyof typeof tabs;\n\nexport function Wallet(props: RouteProps) {\n\n    const [state, setState] = useState({\n        currentTab: tabs.objects,\n    })\n    const [globalState] = useContext(StoreContext)\n\n    const clickHandler = (evt: any) => {\n        const tabStr: tabStrings = evt.target.innerText.toLowerCase()\n        setState({ ...state, currentTab: tabs[tabStr] })\n    }\n\n    const pageContent = (tab: tabs) => {\n        if (globalState.userTree === undefined) {\n            throw new Error(\"can't get page content without a usertree\")\n        }\n        switch (tab) {\n            case tabs.tokens:\n                return <TokenWallet />\n            case tabs.creator:\n                return <ObjectCreator userTree={globalState.userTree} />\n            case tabs.objects:\n                return <ObjectWallet />\n            default:\n                throw new Error(\"unrecognized tab: \" + tab)\n        }\n    }\n\n    if (!globalState.userTree) {\n        return (\n            <Redirect to={{\n                pathname: \"/login\",\n                state: { from: props.location },\n            }} />\n        )\n    }\n\n    return (\n        <Container>\n            <Heading>Wallet</Heading>\n            <h1>did: {globalState.userDid}</h1>\n            <Tabs>\n                <Tabs.Tab onClick={clickHandler} active={state.currentTab === tabs.objects}>Objects</Tabs.Tab>\n                <Tabs.Tab onClick={clickHandler} active={state.currentTab === tabs.tokens}>Tokens</Tabs.Tab>\n                <Tabs.Tab onClick={clickHandler} active={state.currentTab === tabs.creator}>Creator</Tabs.Tab>\n            </Tabs>\n            {pageContent(state.currentTab)}\n        </Container>\n    )\n}","import React, { useContext } from 'react';\nimport { Message, Button } from 'react-bulma-components';\nimport { StoreContext, IAppMessage, AppActions, IAppRemoveMessage } from '../state/store';\n\nexport function UserMessageList() {\n    const [globalState] = useContext(StoreContext)\n\n    const lis = globalState.messages.map((msg)=> {\n        return <MessageElement message={msg} />\n    })\n\n    return (\n        <div id=\"messages\" style={{ position: 'absolute', right: '10px', zIndex:1}}>\n            <ol style={{ width: '400px', listStyleType: 'none' }}>\n                {lis}\n            </ol>\n        </div>\n    )\n}\n\nconst MessageElement = ({ message }: { message: IAppMessage}) => {\n    const [,globalDispatch] = useContext(StoreContext)\n\n    if (message.id === undefined) {\n        throw new Error(\"a message must have an id when it's in the list\")\n    }\n\n    return (\n        <li key={message.id}>\n            <Message color=\"info\">\n                <Message.Header>\n                    {message.title}\n                <Button remove onClick={()=> { globalDispatch({type: AppActions.removeMessage, id: message.id} as IAppRemoveMessage) }}/>\n                </Message.Header>\n                <Message.Body>\n                    {message.body}\n              </Message.Body>\n            </Message>\n        </li>\n    )\n}","import React, { useContext } from 'react';\nimport './App.css';\nimport 'react-bulma-components/dist/react-bulma-components.min.css';\nimport { Navbar, Container, Loader, Columns, Section } from 'react-bulma-components'\nimport { LoginForm } from './pages/login';\nimport { StoreProvider, StoreContext } from './state/store';\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport { Wallet } from './pages/wallet';\n\nimport { UserMessageList } from './components/messagelist'\n\nconst Routing = () => {\n  const [globalState] = useContext(StoreContext)\n\n\n  return (\n    globalState.loading > 0 ?\n      <Section>\n        <Columns className=\"is-desktop is-centered is-vcentered\">\n          <Loader style={{ height: 100, width: 100 }} />\n        </Columns>\n      </Section>\n      :\n      <div>\n        <UserMessageList />\n        <Router>\n          <Switch>\n            <Route path=\"/login\">\n              <LoginForm />\n            </Route>\n            <Route path=\"/wallet\">\n              <Wallet />\n            </Route>\n            <Route>\n              <LoginForm />\n            </Route>\n          </Switch>\n        </Router>\n      </div>\n  )\n}\n\n\nconst App: React.FC = () => {\n\n  return (\n    <StoreProvider >\n      <Container>\n        <Navbar transparent={false}>\n          <Navbar.Brand>\n            Tupelo\n        </Navbar.Brand>\n        </Navbar>\n      </Container>\n      <Routing />\n\n    </StoreProvider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React, { useReducer, useState, useContext } from 'react';\nimport { Columns, Heading, Form, Icon, Loader, Button } from 'react-bulma-components';\nimport { getAppCommunity } from '../util/appcommunity';\nimport { EcdsaKey, ChainTree, Tupelo, setOwnershipTransaction, setDataTransaction } from 'tupelo-wasm-sdk';\nimport { RouteProps, Redirect } from 'react-router';\nimport {StoreContext, AppActions, IAppLogin} from '../state/store'\nimport {publicUserKey, usernameKey} from '../util/usernames'\n\ninterface ILoginState {\n    loading: boolean\n    username: string\n    password: string\n    userTree?: ChainTree\n    loadingText: string\n}\n\nenum Actions {\n    loginFormType,\n    passwordFormType,\n    userTree,\n    registering,\n    loggingIn,\n}\n\ninterface ILoginActions {\n    type: Actions\n}\n\ninterface IUsernameType extends ILoginActions {\n    type: Actions.loginFormType\n    username: string\n    dispatch: Function\n}\n\ninterface IPasswordType extends ILoginActions {\n    type: Actions.passwordFormType\n    password: string\n}\n\ninterface IUserTree extends ILoginActions {\n    type: Actions.userTree\n    username: string\n    tree?: ChainTree\n    dispatch: Function\n}\n\nconst initialState = {\n    loading: false,\n    username: '',\n    password: '',\n    loadingText: '',\n}\n\n\nlet usernameTimeout: number | undefined;\n\n// debounced username checker\nconst checkUsername = (state: ILoginState, dispatch: Function) => {\n\n    const later = async () => {\n        const c = await getAppCommunity()\n\n        const username = state.username\n        if (!username) {\n            return //nothing to do on an empty username\n        }\n        console.log(\"actually checking: \", username)\n        const key = await publicUserKey(username)\n        // Convert the key to a tupelo DID (ChainTree id)\n        const did = await Tupelo.ecdsaPubkeyToDid(key.publicKey)\n\n        let tip\n        let tree: ChainTree | undefined = undefined\n        try {\n            tip = await c.getTip(did)\n        } catch (e) {\n            if (e === \"not found\") {\n                // do nothing, let tip be null\n            }\n        }\n        if (tip !== undefined) {\n            tree = new ChainTree({\n                store: c.blockservice,\n                tip: tip,\n            })\n        }\n\n        dispatch({\n            type: Actions.userTree,\n            username: username,\n            tree: tree,\n            dispatch: dispatch,\n        } as IUserTree)\n\n        usernameTimeout = undefined;\n    };\n\n    clearTimeout(usernameTimeout);\n    usernameTimeout = setTimeout(later, 150) as any; // nodejs and browser have differing types for the timeout return\n}\n\nfunction reducer(state: ILoginState, action: ILoginActions) {\n    switch (action.type) {\n        case Actions.loginFormType:\n            const username = (action as IUsernameType).username\n            checkUsername(state, (action as IUsernameType).dispatch)\n            return { ...state, loading: true, loginText: 'Checking for username availability', username: username }\n        case Actions.userTree:\n            const act = action as IUserTree\n            console.log(\"user tree received: \", act.username, \" state: \", state.username)\n            if (act.username !== state.username) {\n                // this means we missed one\n                checkUsername(state, act.dispatch)\n                return state // don't update anything yet\n            }\n            return { ...state, loading: false, loadingText: '', userTree: (action as IUserTree).tree }\n        case Actions.passwordFormType:\n            return { ...state, password: (action as IPasswordType).password }\n        case Actions.registering:\n            return { ...state, loading: true, loadingText: 'Registering your user' }\n        case Actions.loggingIn:\n            return { ...state, loading: true, loadingText: 'Logging in' }\n        default:\n            throw new Error(\"unkown type: \" + action.type)\n    }\n}\n\nconst isAvailable = (state: ILoginState) => {\n    return !state.loading && state.username && !state.userTree\n}\n\n// colors: '\"link\" | \"success\" | \"primary\" | \"info\" | \"warning\" | \"danger\" | \"light\" | \"dark\" | \"white\" | \"black\" |\n\nfunction UsernameField({ state, onChange }: { state: ILoginState, onChange: React.ChangeEventHandler }) {\n    return (\n        <Form.Field>\n            <Form.Label>Username</Form.Label>\n            <Form.Control iconLeft>\n                <Form.Input color={isAvailable(state) ? \"success\" : \"info\"} type=\"text\" placeholder=\"Username\" value={state.username} onChange={onChange} />\n                {state.loading ?\n                    <Icon align=\"left\"><span className=\"fas fa-spinner fa-pulse\" /></Icon>\n                    :\n                    <Icon align=\"left\"><span className=\"fas fa-user\" /></Icon>\n                }\n            </Form.Control>\n            {isAvailable(state) && <Form.Help color=\"success\">This username is available</Form.Help>}\n        </Form.Field>\n    )\n}\n\nfunction PasswordField({ name, value, onChange, error }: { name: string, value: string, error: string, onChange: React.ChangeEventHandler }) {\n    return (\n        <Form.Field>\n            <Form.Label>{name}</Form.Label>\n            <Form.Control iconLeft>\n                <Form.Input className={error ? \"animated pulse faster\" : \"\"} color={error ? \"danger\" : \"info\"} type=\"password\" placeholder=\"Password\" value={value} onChange={onChange} />\n                <Icon align=\"left\"><span className=\"fas fa-key\" /></Icon>\n            </Form.Control>\n            {error && <Form.Help color=\"danger\">{error}</Form.Help>}\n        </Form.Field>\n    )\n}\n\n// the elements at the bottom of a login form\nfunction LoginBottom({ state, dispatch, onLogin }: { state: ILoginState, dispatch: Function, onLogin:Function }) {\n    const [password, setPassword] = useState('')\n    const [error, setError] = useState('')\n\n    const handleSubmit = async () => {\n        if (state.userTree === undefined) {\n            throw new Error(\"must have a user tree to login\")\n        }\n\n        const tree = state.userTree\n        const username = state.username\n\n        let secureKey = await EcdsaKey.passPhraseKey(Buffer.from(password), Buffer.from(username))\n        let secureAddr = await Tupelo.ecdsaPubkeyToAddress(secureKey.publicKey)\n        let resolveResp = await tree.resolve(\"tree/_tupelo/authentications\")\n        let auths: string[] = resolveResp.value\n        if (auths.includes(secureAddr)) {\n            tree.key = secureKey\n            onLogin(state.userTree)\n        } else {\n            setError(\"invalid password\")\n        }\n    }\n\n    return (\n        <div>\n            <PasswordField error={error} name=\"Password\" value={password} onChange={(evt: React.ChangeEvent<HTMLInputElement>) => { setError(''); setPassword(evt.target.value) }} />\n            <Button onClick={handleSubmit}>Login</Button>\n        </div>\n    )\n}\n\n// the elements at the bottom of a login form\nfunction RegisterBottom({ state, dispatch, onLogin }: { state: ILoginState, dispatch: Function, onLogin:Function }) {\n    const [password, setPassword] = useState('')\n    const [passwordConfirm, setPasswordConfirm] = useState('')\n    const [error, setError] = useState('')\n\n    const isConfirmed = () => {\n        return password === passwordConfirm\n    }\n\n    const handleSubmit = () => {\n        if (!isConfirmed()) {\n            setError('Passwords do not match')\n            return // do nothing here\n        }\n        dispatch({ type: Actions.registering })\n        const doRegister = async ()=> {\n            const username = state.username\n            const insecureKey = await publicUserKey(username)\n    \n            const secureKey = await EcdsaKey.passPhraseKey(Buffer.from(password), Buffer.from(username))\n            const secureKeyAddress = await Tupelo.ecdsaPubkeyToAddress(secureKey.publicKey)\n    \n            const community = await getAppCommunity()\n            const tree = await ChainTree.newEmptyTree(community.blockservice, insecureKey)\n    \n            await community.playTransactions(tree, [\n                // Set the ownership of the chaintree to our secure key (thus owning the username)\n                setOwnershipTransaction([secureKeyAddress]),\n                // Cache the username inside of the chaintree for easier access later\n                setDataTransaction(usernameKey, username),\n            ])\n            tree.key = secureKey\n            onLogin(tree)\n        }\n        doRegister()\n    }\n\n    return (\n        <div>\n            <PasswordField error={error} name=\"Password\" value={password} onChange={(evt: React.ChangeEvent<HTMLInputElement>) => { setError(''); setPassword(evt.target.value) }} />\n            <PasswordField error={error} name=\"Confirm Password\" value={passwordConfirm} onChange={(evt: React.ChangeEvent<HTMLInputElement>) => { setError(''); setPasswordConfirm(evt.target.value) }} />\n            <Button onClick={handleSubmit}>Register</Button>\n        </div>\n    )\n}\n\nexport function LoginForm(props:RouteProps) {\n    const [state, dispatch] = useReducer(reducer, initialState)\n    const [redirect,doRedirect] = useState(false)\n\n    const [,globalDispatch] = useContext(StoreContext)\n\n    const handleUsernameChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        dispatch({ type: Actions.loginFormType, username: evt.target.value, dispatch: dispatch } as IUsernameType)\n    }\n\n    const onLogin = (tree:ChainTree) => {\n        globalDispatch({\n            type: AppActions.login,\n            userTree: tree,\n        } as IAppLogin)\n        doRedirect(true)\n    }\n\n    let { from } = (props.location && props.location.state) ? props.location.state : { from: { pathname: \"/wallet\" } };\n\n    if (redirect) {\n        return (\n            <Redirect to={from}/>\n        )\n    }\n\n    return (\n        <div>\n            <Columns className=\"is-desktop is-centered\">\n                <Columns.Column size={\"half\"} className=\"is-centered\">\n                    <Heading className=\"animated flipInX fast\">Hello.</Heading>\n                    <p>Find or create your wallet.</p>\n                </Columns.Column>\n            </Columns>\n\n            <Columns className=\"is-desktop is-centered\">\n                <Columns.Column size={\"half\"}>\n                    <UsernameField state={state} onChange={handleUsernameChange} />\n                    {state.loading && state.username && \n                        <div>\n                            <Loader style={{ width: 25, height: 25 }} />\n                            <p className=\"animated flipInX fast\">{state.loadingText}</p>\n                        </div>\n                    }\n                    {!state.loading && state.username && state.userTree && <LoginBottom state={state} dispatch={dispatch} onLogin={onLogin}/>}\n                    {!state.loading && state.username && !state.userTree && <RegisterBottom state={state} dispatch={dispatch} onLogin={onLogin} />}\n                </Columns.Column>\n            </Columns>\n        </div>\n    )\n}\n","\nimport { Community } from 'tupelo-wasm-sdk';\nimport debug from 'debug';\n\nconst log = debug(\"appcommunity\")\n\nlet _appPromise: Promise<Community>\n\nexport function getAppCommunity(): Promise<Community> {\n    log(\"getAppCommunity\")\n    if (_appPromise !== undefined) {\n        return _appPromise\n    }\n    _appPromise = new Promise(async (resolve, reject) => {\n        let c: Community\n        switch (process.env.NODE_ENV) {\n            case 'production':\n                log('using production community')\n                c = await Community.getDefault()\n                break;\n            default:\n                log('using development community')\n                c = await Community.freshLocalTestCommunity()\n        }\n        resolve(c)\n    })\n    return _appPromise\n}\n","import React, { createContext, useReducer, useEffect, useState } from \"react\";\nimport { ChainTree, EcdsaKey } from \"tupelo-wasm-sdk\";\nimport { getAppCommunity } from \"../util/appcommunity\";\n\ndeclare const Go: any;\n\nif (window) {\n  const subDirectory = window.location.pathname\n  console.log(\"subDirectory \", subDirectory)\n\n  if (subDirectory !== '/') {\n    console.log(\"setting wasmpath to: \", subDirectory + \"tupelo.wasm\")\n    Go.setWasmPath(subDirectory + \"tupelo.wasm\");\n  }\n}\n\ninterface IAppState {\n  userTree?: ChainTree\n  username?: string\n  userDid?: string\n  loading: number\n  messages: IAppMessage[]\n}\n\nexport interface IAppMessage {\n  id?: string\n  color?: string\n  title: string\n  body: string\n}\n\nexport enum AppActions {\n  loading,\n  stopLoading,\n  login,\n  setDID,\n  removeMessage,\n  message,\n  logout,\n}\n\nexport interface IAppAction {\n  type: AppActions\n}\n\nexport interface IAppLoading extends IAppAction {\n  type: AppActions.loading\n}\n\nexport interface IAppStopLoading extends IAppAction {\n  type: AppActions.stopLoading\n}\n\nexport interface IAppLogin extends IAppAction {\n  type: AppActions.login\n  userTree: ChainTree\n}\n\nexport interface IAppRemoveMessage extends IAppAction {\n  type: AppActions.removeMessage,\n  id: string\n}\n\nexport interface IAppMessage extends IAppAction {\n  type: AppActions.message,\n  message: IAppMessage,\n}\n\ninterface IAppSetDid extends IAppAction {\n  type: AppActions.setDID\n  did: string\n}\n\nexport interface IAppLogout extends IAppAction {\n  type: AppActions.logout\n}\n\nfunction reducer(state: IAppState, action: IAppAction) {\n  let act\n  switch (action.type) {\n    case AppActions.loading:\n      return { ...state, loading: state.loading + 1 }\n    case AppActions.stopLoading:\n      return { ...state, loading: state.loading - 1 }\n    case AppActions.login:\n      act = action as IAppLogin\n      return { ...state, userTree: act.userTree }\n    case AppActions.setDID:\n      return { ...state, userDid: (action as IAppSetDid).did }\n    case AppActions.logout:\n      sessionStorage.removeItem('userDid')\n      sessionStorage.removeItem('userKey')\n      return {...initialState, loading: 0} \n    case AppActions.message:\n      const msg = (action as IAppMessage).message\n      msg.id = (new Date()).toString() + \"-\" + msg.title + Math.random().toString()\n      return { ...state, messages: [...state.messages, msg] }\n    case AppActions.removeMessage:\n      const id = (action as IAppRemoveMessage).id\n      let index = -1;\n      for (var i = state.messages.length - 1; i >= 0; i--) {\n        if (state.messages[i].id === id) {\n          index = i\n          break;\n        }\n      }\n      if (index === -1) {\n        return state // nothing to do here\n      }\n      return { ...state, messages: [...state.messages.slice(0, index), ...state.messages.slice(index + 1)] }\n    default:\n      throw new Error(\"unkown type: \" + action.type)\n  }\n}\n\nconst initialState = { loading: 1, messages: [] } as IAppState\n\nconst StoreContext = createContext([initialState, () => { }] as [IAppState, React.Dispatch<IAppAction>]);\n\nconst StoreProvider = ({ children }: { children: JSX.Element[] }) => {\n  const [firstRun, setFirstRun] = useState(true);\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  // On every state set\n  useEffect(\n    () => {\n      if (firstRun) {\n        setFirstRun(false)\n\n        const did = sessionStorage.getItem('userDid')\n        const userKey = sessionStorage.getItem('userKey')\n        const doAsyncSet = async () => {\n          if (!did || !userKey) {\n            throw new Error(\"no did or no userKey\")\n          }\n          const c = await getAppCommunity()\n          let tip\n          try {\n            tip = await c.getTip(did)\n          } catch(e) {\n            // in this case, the user had a set userDId, key, but\n            // the network didn't know about them, so let's just\n            // unset and let them login again\n            if (e === 'not found') {\n              dispatch({\n                type: AppActions.logout,\n              } as IAppLogout)\n              return\n            }\n            throw e\n          }\n          const key = await EcdsaKey.fromBytes(Buffer.from(userKey, 'base64'))\n\n          const tree = new ChainTree({\n            key: key,\n            tip: tip,\n            store: c.blockservice,\n          })\n          console.log('logging in from storage')\n          dispatch({\n            type: AppActions.login,\n            userTree: tree,\n          } as IAppLogin)\n          dispatch({\n            type: AppActions.stopLoading,\n          } as IAppStopLoading)\n        }\n\n        if (did && userKey) {\n          doAsyncSet()\n        } else {\n          console.log('stopping loading')\n          dispatch({\n            type: AppActions.stopLoading\n          } as IAppStopLoading)\n        }\n      }\n\n      if (!state.userDid && state.userTree) {\n        // if we didn't yet assign the DID, do that\n        state.userTree.id().then((did) => {\n          dispatch({\n            type: AppActions.setDID,\n            did: did,\n          } as IAppSetDid)\n        })\n      }\n      if (state.userTree && state.userDid && state.userTree.key && state.userTree.key.privateKey) {\n        sessionStorage.setItem('userDid', state.userDid)\n        sessionStorage.setItem('userKey', Buffer.from(state.userTree.key.privateKey).toString('base64'))\n      }\n\n      console.log({ newState: state });\n    },\n    [state, firstRun]\n  );\n\n  // Render state, dispatch and special case actions\n  return (\n    <StoreContext.Provider value={[state, dispatch]}>\n      {children}\n    </StoreContext.Provider>\n  );\n};\n\nexport { StoreContext, StoreProvider };\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 536;","import { EcdsaKey, Tupelo, ChainTree } from \"tupelo-wasm-sdk\"\nimport { getAppCommunity } from \"./appcommunity\"\n\nexport const usernameKey = \"/_wallet/username\"\nexport const namespace = Buffer.from(\"_wallet-dev\")\n\n/**\n * Generates a public/private keypair from an *insecure* passphrase.\n * This method is used to generate a ChainTree with a known name (given a namespace)\n * The very first thing you do with the ChainTree should be to ChangeOwner\n * @param userName - the username\n */\nexport const publicUserKey = (userName: string) => {\n    return EcdsaKey.passPhraseKey(Buffer.from(userName), namespace)\n}\n\nexport const didFromUserName = async (userName: string) => {\n    const userKey = await publicUserKey(userName)\n    return Tupelo.ecdsaPubkeyToDid(userKey.publicKey)\n}\n\nexport const getUserTree = async (userName: string) => {\n    const c = await getAppCommunity()\n    const userDid = await didFromUserName(userName)\n    let userTip\n    try {\n        userTip = await c.getTip(userDid)\n    } catch(e) {\n        throw e\n    }\n\n    return new ChainTree({\n        store: c.blockservice,\n        tip: userTip\n    })\n}\n"],"sourceRoot":""}