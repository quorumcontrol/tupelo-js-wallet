(window.webpackJsonpwallet=window.webpackJsonpwallet||[]).push([[0],{1127:function(e,t){},1129:function(e,t){},1204:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(270),c=n.n(o),l=(n(505),n(7)),s=(n(506),n(507),n(1)),u=n(271),i=n(32),m=n(499),d=n(41),p=n(22),f=n(5),b=n.n(f),g=n(18),v=n(12),E=n(28);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(r.useState)({loading:!1,tokenName:"",maximum:0}),u=Object(l.a)(c,2),i=u[0],m=u[1],d=function(e){m(O({},i,Object(p.a)({},e.target.name,e.target.value)))};return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Establish Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,i.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:i.tokenName,onChange:d,name:"tokenName",placeholder:"Token Name"}))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Maximum Mint"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{type:"number",value:i.maximum.toString(),onChange:d,name:"maximum",placeholder:"Maximum Mint"})),a.a.createElement(s.Form.Help,null,"Leave as 0 to allow unlimited minting")),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){m(O({},i,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)();case 2:return t=e.sent,e.next=5,t.playTransactions(o,[Object(v.establishTokenTransaction)(i.tokenName,i.maximum)]);case 5:m(O({},i,{loading:!1,tokenName:"",maximum:0})),n();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Establish"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var w=n(69);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T="/tree/_tupelo/tokens";function x(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,u=Object(r.useContext)(i.b),m=Object(l.a)(u,2)[1],d={loading:!1,tokenName:"",destination:"",amount:"",destinationError:"",amountError:""},f=Object(r.useState)(d),h=Object(l.a)(f,2),O=h[0],y=h[1],j=function(){return""!==O.destinationError},x=function(){return""!==O.amountError},C=function(e){y(k({},O,Object(p.a)({},e.target.name,e.target.value)))},P=Object.keys(c).map((function(e){return a.a.createElement("option",{key:e,value:e},e)}));return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Send Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,O.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Select,{onChange:C,value:O.tokenName,name:"tokenName"},a.a.createElement("option",{value:""}),P))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Destination"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{color:j()?"danger":"info",value:O.destination,onChange:C,name:"destination",placeholder:"Where to send"})),j()&&a.a.createElement(s.Form.Help,{color:"danger"},O.destinationError)),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Amount"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{color:x()?"danger":"info",type:"number",value:O.amount,onChange:C,name:"amount",placeholder:"Amount to send"})),x()&&a.a.createElement(s.Form.Help,{color:"danger"},O.amountError)),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){y(k({},O,{loading:!0,destinationError:"",amountError:""})),function(){var e=Object(g.a)(b.a.mark((function e(){var t,r,a,c,l,s,u,p,f,g,h,j,x,C,P;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sending: ",O),e.next=3,Object(E.a)();case 3:return t=e.sent,e.next=6,o.resolve(T+"/"+O.tokenName);case 6:if(r=e.sent,a=r.value.balance,!(parseInt(O.amount,10)>a)){e.next=11;break}return y((function(e){return k({},e,{amountError:"That's too much. You don't have that",loading:!1})})),e.abrupt("return");case 11:return e.prev=11,e.next=14,Object(w.a)(O.destination);case 14:c=e.sent,e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(11),"not found"!==e.t0){e.next=22;break}return y((function(e){return k({},e,{destinationError:"User not found",loading:!1})})),e.abrupt("return");case 22:throw e.t0;case 23:return e.next=25,v.EcdsaKey.generate();case 25:return l=e.sent,e.next=28,v.ChainTree.newEmptyTree(t.blockservice,l);case 28:return s=e.sent,e.next=31,o.id();case 31:return u=e.sent,e.next=34,c.id();case 34:return p=e.sent,e.next=37,s.id();case 37:if(f=e.sent,null!==u&&null!==p&&null!==f){e.next=40;break}throw new Error("error getting userdid, destdid or ephemeralDID");case 40:return console.log("ephemeralDID: ",f),e.next=43,o.resolve("tree/_tupelo/authentications");case 43:return g=e.sent,e.next=46,c.resolve("tree/_tupelo/authentications");case 46:return h=e.sent,j=u+"->"+p+Math.random().toString(),console.log("sending token to ephemeral"),x=Object(v.sendTokenTransaction)(j,O.tokenName,parseInt(O.amount,10),f),console.log("send tx: ",x.toObject()),e.next=53,t.sendTokenAndGetPayload(o,x);case 53:return C=e.sent,console.log("receiving on ephemeral, payload: ",C.toObject()),P=Object(v.receiveTokenTransactionFromPayload)(C),console.log("receiveTx: ",P.toObject()),e.next=59,t.playTransactions(s,[Object(v.setOwnershipTransaction)(g.value.concat(h.value)),P]);case 59:console.log("done"),y(d),n(),m({type:i.a.message,message:{title:"Sent "+O.amount+" token to user: "+O.destination,body:"Ask "+O.destination+" to use this DID in their receive token: \n"+f}});case 63:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(){return e.apply(this,arguments)}}()()}},"Send"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,u=Object(r.useState)({loading:!1,tokenName:"",amount:0}),i=Object(l.a)(u,2),m=i[0],d=i[1],f=function(e){d(P({},m,Object(p.a)({},e.target.name,e.target.value)))},h=Object.keys(c).map((function(e){return a.a.createElement("option",{key:e,value:e},e)}));return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Mint Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,m.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Select,{onChange:f,value:m.tokenName,name:"tokenName"},a.a.createElement("option",{value:""}),h))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Amount"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{type:"number",value:m.amount.toString(),onChange:f,name:"amount",placeholder:"Amount to Mint"}))),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){d(P({},m,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)();case 2:return t=e.sent,e.next=5,t.playTransactions(o,[Object(v.mintTokenTransaction)(m.tokenName,m.amount)]);case 5:d(P({},m,{loading:!1,tokenName:"",amount:0})),n();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Mint"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var D=n(118),S=n(172),M=n(8),L=n.n(M)()("util:syncher"),I=function(){function e(t){Object(D.a)(this,e),this.queue=void 0,this.started=void 0,this.name=void 0,this.started=!1,this.queue=[],this.name=t}return Object(S.a)(e,[{key:"run",value:function(){var e=Object(g.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.queue.pop())){e.next=5;break}return L(this.name," stopping syncher"),this.started=!1,e.abrupt("return");case 5:return e.prev=5,L(this.name," run fn",t.fn.toString()),e.next=9,t.fn();case 9:n=e.sent,L(this.name," finish fn"),t.res(n),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),L(this.name," rejecting: ",e.t0),t.rej(e.t0);case 18:this.queue.length>0?(L(this.name,"syncher queueing another"),this.run()):this.started=!1;case 19:case"end":return e.stop()}}),e,this,[[5,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;return new Promise((function(n,r){if(t.queue.push({fn:e,res:n,rej:r}),!t.started)return L(t.name," not started, starting"),t.started=!0,void t.run();L(t.name," run already started")}))}}]),e}();function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A="/tree/_tupelo/tokens";function K(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(r.useState)({loading:!1,did:""}),u=Object(l.a)(c,2),i=u[0],m=u[1];return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Receive Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,i.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"DID"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:i.did,onChange:function(e){m(B({},i,Object(p.a)({},e.target.name,e.target.value)))},name:"did",placeholder:"DID of tokens"})),a.a.createElement(s.Form.Help,null,"This is the code that begins with 'did:tupelo:' that the sender has from the wallet.\xe5")),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){m(B({},i,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){var t,r,a,c,l,s,u,d,p;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)();case 2:return t=e.sent,e.next=5,o.id();case 5:if(null!==(r=e.sent)){e.next=8;break}throw new Error("user tree had null id");case 8:return e.next=10,t.getTip(i.did);case 10:return a=e.sent,c=new v.ChainTree({store:t.blockservice,tip:a,key:o.key}),e.next=14,c.resolve(A);case 14:return l=e.sent,e.next=17,Promise.all(Object.keys(l.value||{}).map(function(){var e=Object(g.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.resolve(A+"/"+t);case 2:return n=e.sent,e.abrupt("return",{name:t,balance:n.value.balance});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:return s=e.sent,u=new I,e.next=21,Promise.all(s.map((function(e){return u.send((function(){return t.sendTokenAndGetPayload(c,Object(v.sendTokenTransaction)("uuid"+Math.random().toString(),e.name,e.balance,r))}))})));case 21:return d=e.sent,p=d.map((function(e){return Object(v.receiveTokenTransactionFromPayload)(e)})),e.next=25,t.playTransactions(o,p);case 25:m((function(e){return B({},e,{loading:!1,did:""})})),n();case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Receive"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R="/tree/_tupelo/tokens";function q(e){var t=Object(r.useState)({loading:!0,tokens:{},showEstablishModal:!1,showMintModal:!1,showSendModal:!1,showReceiveModal:!1,modifiedAt:0}),n=Object(l.a)(t,2),o=n[0],c=n[1],u=Object(r.useContext)(i.b),m=Object(l.a)(u,1)[0];if(Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==m.userTree){e.next=2;break}throw new Error("user tree must be defined");case 2:return e.prev=2,e.next=5,m.userTree.resolve(R);case 5:t=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("e: ",e.t0),c((function(e){return _({},e,{tokens:{},loading:!1})}));case 12:console.log("tokens resp: ",t),c((function(e){return _({},e,{tokens:t.value||{},loading:!1})}));case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();console.log("loading tokens"),e()}),[m.userTree,o.modifiedAt]),!m.userTree)return a.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}});if(o.loading)return a.a.createElement(s.Loader,null);var p=Object.keys(o.tokens).map((function(e){if(void 0===m.userTree)throw new Error("undefined user tree!");return a.a.createElement(z,{key:e,modifiedAt:o.modifiedAt,tree:m.userTree,tokenName:e})})),f=function(){console.log("setting modifiedAt"),c((function(e){return _({},e,{modifiedAt:Date.now()})}))};return a.a.createElement("div",null,a.a.createElement(y,{userTree:m.userTree,show:o.showEstablishModal,onClose:function(){f(),c(_({},o,{showEstablishModal:!1}))}}),a.a.createElement(F,{tokens:o.tokens,userTree:m.userTree,show:o.showMintModal,onClose:function(){f(),c(_({},o,{showMintModal:!1}))}}),a.a.createElement(x,{tokens:o.tokens,userTree:m.userTree,show:o.showSendModal,onClose:function(){f(),c(_({},o,{showSendModal:!1}))}}),a.a.createElement(K,{userTree:m.userTree,show:o.showReceiveModal,onClose:function(){f(),c(_({},o,{showReceiveModal:!1}))}}),a.a.createElement(s.Level,null,a.a.createElement(s.Level.Side,{align:"left"},a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showSendModal:!0}))}},"Send Token")),a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showReceiveModal:!0}))}},"Receive Token")))),a.a.createElement(s.Table,null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Name"),a.a.createElement("th",null,"Balance"),a.a.createElement("th",null,"Max"))),a.a.createElement("tbody",null,p)),a.a.createElement(s.Level,null,a.a.createElement(s.Level.Side,{align:"left"},a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showEstablishModal:!0}))}},"Establish Token")),a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showMintModal:!0}))}},"Mint Token")))))}var z=function(e){var t=e.tree,n=e.tokenName,o=e.modifiedAt,c=Object(r.useState)({balance:0,max:null,loading:!0}),u=Object(l.a)(c,2),i=u[0],m=u[1];return Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(b.a.mark((function e(){var r,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=R+"/"+n,e.next=3,t.resolve(r);case 3:if(a=e.sent,console.log("tokenInfoResp ",r,a),!a.value.monetaryPolicy){e.next=10;break}return e.next=8,t.resolve(r+"/monetaryPolicy");case 8:o=e.sent,m((function(e){return _({},e,{max:o.value.maximum})}));case 10:m((function(e){return _({},e,{balance:a.value.balance,loading:!1})}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();console.log("loading tokenRow"),e()}),[t,n,o]),a.a.createElement("tr",null,a.a.createElement("td",null,n),a.a.createElement("td",null,i.loading?a.a.createElement(s.Loader,null):i.balance),a.a.createElement("td",null,i.loading?a.a.createElement(s.Loader,null):i.max))};function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){var t=e.userTree,n=Object(r.useState)({title:"",subtitle:"",content:""}),o=Object(l.a)(n,2),c=o[0],u=o[1],i=Object(r.useState)(!1),m=Object(l.a)(i,2),d=m[0],f=m[1];function h(){return(h=Object(g.a)(b.a.mark((function e(){var n,r,a,o,s,i,m,d,p,g,h,O,y,w,j,k;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c,void 0!==t.key){e.next=3;break}throw new Error("undefined userTree key");case 3:return r=v.EcdsaKey.generate(),a=Object(E.a)(),e.next=7,Promise.all([r,a]);case 7:return o=e.sent,s=Object(l.a)(o,2),i=s[0],m=s[1],d=v.ChainTree.newEmptyTree(m.blockservice,i),p=v.Tupelo.ecdsaPubkeyToAddress(t.key.publicKey),e.next=15,Promise.all([d,p]);case 15:return g=e.sent,h=Object(l.a)(g,2),O=h[0],y=h[1],e.next=21,O.id();case 21:if(null!==(w=e.sent)){e.next=24;break}throw new Error("unknown tree DID");case 24:return j=m.playTransactions(O,[Object(v.setDataTransaction)("/_wallet/attributes",{title:n.title,subtitle:n.subtitle,content:n.content}),Object(v.setOwnershipTransaction)([y])]),k=m.playTransactions(t,[Object(v.setDataTransaction)("/_wallet/nfts/"+w,Date.now())]),e.next=28,Promise.all([j,k]);case 28:u({}),f(!1);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=function(e){var t=e.target;u(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c,Object(p.a)({},t.name,t.value)))};return a.a.createElement("div",null,a.a.createElement(s.Heading,null,"Object Creator"),a.a.createElement("p",null,"This lets you create an NFT!"),d?a.a.createElement(s.Loader,null):a.a.createElement(s.Box,{style:{marginTop:"1em"}},a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Title"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:c.title,onChange:O,name:"title",placeholder:"title"}))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Subtitle"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:c.subtitle,onChange:O,name:"subtitle",placeholder:"subtitle"}))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Content"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:c.content,onChange:O,name:"content",placeholder:"content"}))),a.a.createElement(s.Button,{onClick:function(){f(!0),function(){h.apply(this,arguments)}()}},"Create")))}var G=n(498);function J(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e){var t=e.did,n=e.onSend,o=Object(r.useState)({loading:!0,tree:void 0,attrs:{},sending:!1,destination:""}),c=Object(l.a)(o,2),u=c[0],i=c[1];Object(r.useEffect)((function(){(function(){var e=Object(g.a)(b.a.mark((function e(){var n,r,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)();case 2:return n=e.sent,e.next=5,n.getTip(t);case 5:return r=e.sent,a=new v.ChainTree({store:n.blockservice,tip:r}),e.next=9,a.resolveData("/_wallet/attributes");case 9:o=e.sent,i((function(e){return Y({},e,{loading:!1,tree:a,attrs:o.value||{}})}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]);return a.a.createElement(s.Card,null,a.a.createElement(s.Card.Header,null,a.a.createElement(s.Card.Header.Title,null,u.attrs.title)),a.a.createElement(s.Card.Content,null,u.loading?a.a.createElement(s.Loader,null):a.a.createElement("div",null,a.a.createElement(s.Media,null,a.a.createElement(s.Media.Item,null,a.a.createElement(s.Heading,{size:4},u.attrs.title),a.a.createElement(s.Heading,{subtitle:!0,size:6},u.attrs.subtitle))),a.a.createElement(s.Content,null,u.attrs.content,a.a.createElement("p",null,t)))),a.a.createElement(s.Card.Footer,null,u.sending?a.a.createElement(s.Content,{style:{padding:"1em"}},a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Destination Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:u.destination,onChange:function(e){i(Y({},u,{destination:e.target.value}))},name:"nftdestination",placeholder:"Destination"}))),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){i(Y({},u,{loading:!0,sending:!1})),n({did:t,tree:u.tree,destination:u.destination})}},"Send"),a.a.createElement(s.Button,{text:!0,onClick:function(){i(Y({},u,{sending:!1,destination:""}))}},"cancel"))):a.a.createElement(s.Card.Footer.Item,null,a.a.createElement(s.Button,{onClick:function(){i(Y({},u,{sending:!0}))}},"Send"))))}function Q(){var e=Object(r.useContext)(i.b),t=Object(l.a)(e,1)[0],n=Object(r.useState)({dids:{}}),o=Object(l.a)(n,2),c=o[0],u=o[1];if(void 0===t.userTree)throw new Error("must have a userTree to use ObjectWallet");var m=function(){var e=Object(g.a)(b.a.mark((function e(n){var r,a,o,l,s,i,m;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=t.userTree)&&void 0!==r.key){e.next=3;break}throw new Error("can only send when a valid user");case 3:return e.next=5,Object(E.a)();case 5:return a=e.sent,e.next=8,Object(w.a)(n.destination);case 8:return o=e.sent,e.next=11,o.resolve("tree/_tupelo/authentications");case 11:return l=e.sent,n.tree.key=r.key,console.log("reassigning ",n.did," to: ",n.destination),e.next=16,a.playTransactions(n.tree,[Object(v.setOwnershipTransaction)(l.value)]);case 16:return console.log("remove did from nfts"),s=c.dids,i=n.did,s[i],m=Object(G.a)(s,[i].map(J)),e.next=20,a.playTransactions(r,[Object(v.setDataTransaction)("/_wallet/nfts",m)]);case 20:u((function(e){return Y({},e,{dids:m})}));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.userTree){e.next=2;break}throw new Error("user tree has to be defined");case 2:return e.next=4,t.userTree.resolveData("/_wallet/nfts");case 4:n=e.sent,u((function(e){return Y({},e,{dids:n.value||{}})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.userTree&&e()}),[t.userTree]);var d=Object.keys(c.dids).map((function(e){return a.a.createElement(s.Columns.Column,{key:e,size:"half"},a.a.createElement($,{onSend:m,did:e}))}));return a.a.createElement("div",null,a.a.createElement(s.Heading,null,"Object wallet"),a.a.createElement(s.Columns,null,d),a.a.createElement(Z,{onAdd:function(e){u((function(t){return Y({},t,{dids:Y({},c.dids,Object(p.a)({},e,Date.now()))})}))},userTree:t.userTree}))}var V,Z=function(e){var t=e.userTree,n=e.onAdd,o=Object(r.useState)({addOpen:!1,addDid:"",addLoading:!1}),c=Object(l.a)(o,2),u=c[0],i=c[1];return a.a.createElement("div",null,u.addOpen?a.a.createElement(s.Box,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Add"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:u.addDid,onChange:function(e){i(Y({},u,{addDid:e.target.value}))},name:"additionalDid",placeholder:"DID"}))),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{onClick:function(){i(Y({},u,{addLoading:!0}));var e=u.addDid;(function(){var r=Object(g.a)(b.a.mark((function r(){var a,o,c,l,s;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==t&&void 0!==t.key){r.next=2;break}throw new Error("user tree undfined");case 2:return r.next=4,Object(E.a)();case 4:return a=r.sent,r.next=7,a.getTip(e);case 7:return o=r.sent,c=new v.ChainTree({store:a.blockservice,tip:o}),r.next=11,v.Tupelo.ecdsaPubkeyToAddress(t.key.publicKey);case 11:return l=r.sent,r.next=14,c.resolve("tree/_tupelo/authentications");case 14:if(s=r.sent,!s.value.includes(l)){r.next=21;break}return r.next=19,a.playTransactions(t,[Object(v.setDataTransaction)("/_wallet/nfts/"+e,Date.now())]);case 19:n(e),i(Y({},u,{addLoading:!1,addDid:""}));case 21:i(Y({},u,{addLoading:!1,addDid:"",addOpen:!1}));case 22:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()()},color:"primary"},"Add"),a.a.createElement(s.Button,{text:!0,onClick:function(){i((function(e){return Y({},e,{addOpen:!1,addDid:""})}))}},"Cancel"))):a.a.createElement(s.Button,{onClick:function(){i((function(e){return Y({},e,{addOpen:!0})}))}},"Add"))};function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){var t=Object(r.useState)({currentTab:V.objects}),n=Object(l.a)(t,2),o=n[0],c=n[1],u=Object(r.useContext)(i.b),m=Object(l.a)(u,1)[0],f=function(e){var t=e.target.innerText.toLowerCase();c(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o,{currentTab:V[t]}))};return m.userTree?a.a.createElement(s.Container,null,a.a.createElement(s.Heading,null,"Wallet"),a.a.createElement("h1",null,"did: ",m.userDid),a.a.createElement(s.Tabs,null,a.a.createElement(s.Tabs.Tab,{onClick:f,active:o.currentTab===V.objects},"Objects"),a.a.createElement(s.Tabs.Tab,{onClick:f,active:o.currentTab===V.tokens},"Tokens"),a.a.createElement(s.Tabs.Tab,{onClick:f,active:o.currentTab===V.creator},"Creator")),function(e){if(void 0===m.userTree)throw new Error("can't get page content without a usertree");switch(e){case V.tokens:return a.a.createElement(q,null);case V.creator:return a.a.createElement(U,{userTree:m.userTree});case V.objects:return a.a.createElement(Q,null);default:throw new Error("unrecognized tab: "+e)}}(o.currentTab)):a.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}})}function ne(){var e=Object(r.useContext)(i.b),t=Object(l.a)(e,1)[0].messages.map((function(e){return a.a.createElement(re,{message:e})}));return a.a.createElement(s.Container,null,a.a.createElement("ol",{style:{listStyleType:"none"}},t))}!function(e){e[e.objects=0]="objects",e[e.tokens=1]="tokens",e[e.creator=2]="creator"}(V||(V={}));var re=function(e){var t=e.message,n=Object(r.useContext)(i.b),o=Object(l.a)(n,2)[1];if(void 0===t.id)throw new Error("a message must have an id when it's in the list");return a.a.createElement("li",{key:t.id},a.a.createElement(s.Message,{color:"info"},a.a.createElement(s.Message.Header,null,t.title,a.a.createElement(s.Button,{remove:!0,onClick:function(){o({type:i.a.removeMessage,id:t.id})}})),a.a.createElement(s.Message.Body,{style:{whiteSpace:"pre"}},t.body)))},ae=function(){var e=Object(r.useContext)(i.b);return Object(l.a)(e,1)[0].loading>0?a.a.createElement(s.Section,null,a.a.createElement(s.Columns,{className:"is-desktop is-centered is-vcentered"},a.a.createElement(s.Loader,{style:{height:100,width:100}}))):a.a.createElement("div",null,a.a.createElement(ne,null),a.a.createElement(m.a,null,a.a.createElement(d.d,null,a.a.createElement(d.b,{path:"/login"},a.a.createElement(u.a,null)),a.a.createElement(d.b,{path:"/wallet"},a.a.createElement(te,null)),a.a.createElement(d.b,null,a.a.createElement(u.a,null)))))},oe=function(){return a.a.createElement(i.c,null,a.a.createElement(s.Container,null,a.a.createElement(s.Navbar,{transparent:!1},a.a.createElement(s.Navbar.Brand,null,"Tupelo"))),a.a.createElement(ae,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},204:function(e,t){},271:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return P}));var r,a=n(7),o=n(22),c=n(5),l=n.n(c),s=n(18),u=n(0),i=n.n(u),m=n(1),d=n(28),p=n(12),f=n(41),b=n(32),g=n(69);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.loginFormType=0]="loginFormType",e[e.passwordFormType=1]="passwordFormType",e[e.userTree=2]="userTree",e[e.registering=3]="registering",e[e.loggingIn=4]="loggingIn"}(r||(r={}));var h,O={loading:!1,username:"",password:"",loadingText:""},y=function(e,t){var n=function(){var n=Object(s.a)(l.a.mark((function n(){var a,o,c,s,u,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(d.a)();case 2:if(a=n.sent,o=e.username){n.next=6;break}return n.abrupt("return");case 6:return console.log("actually checking: ",o),n.next=9,Object(g.b)(o);case 9:return c=n.sent,n.next=12,p.Tupelo.ecdsaPubkeyToDid(c.publicKey);case 12:return s=n.sent,i=void 0,n.prev=14,n.next=17,a.getTip(s);case 17:u=n.sent,n.next=23;break;case 20:n.prev=20,n.t0=n.catch(14),n.t0;case 23:void 0!==u&&(i=new p.ChainTree({store:a.blockservice,tip:u})),t({type:r.userTree,username:o,tree:i,dispatch:t}),h=void 0;case 26:case"end":return n.stop()}}),n,null,[[14,20]])})));return function(){return n.apply(this,arguments)}}();clearTimeout(h),h=setTimeout(n,150)};function w(e,t){switch(t.type){case r.loginFormType:var n=t.username;return y(e,t.dispatch),E({},e,{loading:!0,loginText:"Checking for username availability",username:n});case r.userTree:var a=t;return console.log("user tree received: ",a.username," state: ",e.username),a.username!==e.username?(y(e,a.dispatch),e):E({},e,{loading:!1,loadingText:"",userTree:t.tree});case r.passwordFormType:return E({},e,{password:t.password});case r.registering:return E({},e,{loading:!0,loadingText:"Registering your user"});case r.loggingIn:return E({},e,{loading:!0,loadingText:"Logging in"});default:throw new Error("unkown type: "+t.type)}}var j=function(e){return!e.loading&&e.username&&!e.userTree};function k(e){var t=e.state,n=e.onChange;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Username"),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{color:j(t)?"success":"info",type:"text",placeholder:"Username",value:t.username,onChange:n}),t.loading?i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-spinner fa-pulse"})):i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-user"}))),j(t)&&i.a.createElement(m.Form.Help,{color:"success"},"This username is available"))}function T(e){var t=e.name,n=e.value,r=e.onChange,a=e.error;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,t),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{className:a?"animated pulse faster":"",color:a?"danger":"info",type:"password",placeholder:"Password",value:n,onChange:r}),i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-key"}))),a&&i.a.createElement(m.Form.Help,{color:"danger"},a))}function x(t){var n=t.state,r=(t.dispatch,t.onLogin),o=Object(u.useState)(""),c=Object(a.a)(o,2),d=c[0],f=c[1],b=Object(u.useState)(""),g=Object(a.a)(b,2),v=g[0],E=g[1],h=function(){var t=Object(s.a)(l.a.mark((function t(){var a,o,c,s,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n.userTree){t.next=2;break}throw new Error("must have a user tree to login");case 2:return a=n.userTree,o=n.username,t.next=6,p.EcdsaKey.passPhraseKey(e.from(d),e.from(o));case 6:return c=t.sent,t.next=9,p.Tupelo.ecdsaPubkeyToAddress(c.publicKey);case 9:return s=t.sent,t.next=12,a.resolve("tree/_tupelo/authentications");case 12:u=t.sent,u.value.includes(s)?(a.key=c,r(n.userTree)):E("invalid password");case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement(T,{error:v,name:"Password",value:d,onChange:function(e){E(""),f(e.target.value)}}),i.a.createElement(m.Button,{onClick:h},"Login"))}function C(t){var n=t.state,o=t.dispatch,c=t.onLogin,f=Object(u.useState)(""),b=Object(a.a)(f,2),v=b[0],E=b[1],h=Object(u.useState)(""),O=Object(a.a)(h,2),y=O[0],w=O[1],j=Object(u.useState)(""),k=Object(a.a)(j,2),x=k[0],C=k[1];return i.a.createElement("div",null,i.a.createElement(T,{error:x,name:"Password",value:v,onChange:function(e){C(""),E(e.target.value)}}),i.a.createElement(T,{error:x,name:"Confirm Password",value:y,onChange:function(e){C(""),w(e.target.value)}}),i.a.createElement(m.Button,{onClick:function(){v===y?(o({type:r.registering}),function(){var t=Object(s.a)(l.a.mark((function t(){var r,a,o,s,u,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.username,t.next=3,Object(g.b)(r);case 3:return a=t.sent,t.next=6,p.EcdsaKey.passPhraseKey(e.from(v),e.from(r));case 6:return o=t.sent,t.next=9,p.Tupelo.ecdsaPubkeyToAddress(o.publicKey);case 9:return s=t.sent,t.next=12,Object(d.a)();case 12:return u=t.sent,t.next=15,p.ChainTree.newEmptyTree(u.blockservice,a);case 15:return i=t.sent,t.next=18,u.playTransactions(i,[Object(p.setOwnershipTransaction)([s]),Object(p.setDataTransaction)(g.c,r)]);case 18:i.key=o,c(i);case 20:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()):C("Passwords do not match")}},"Register"))}function P(e){var t=Object(u.useReducer)(w,O),n=Object(a.a)(t,2),o=n[0],c=n[1],l=Object(u.useState)(!1),s=Object(a.a)(l,2),d=s[0],p=s[1],g=Object(u.useContext)(b.b),v=Object(a.a)(g,2)[1],E=function(e){v({type:b.a.login,userTree:e}),p(!0)},h=(e.location&&e.location.state?e.location.state:{from:{pathname:"/wallet"}}).from;return d?i.a.createElement(f.a,{to:h}):i.a.createElement("div",null,i.a.createElement(m.Columns,{className:"is-desktop is-centered"},i.a.createElement(m.Columns.Column,{size:"half",className:"is-centered"},i.a.createElement(m.Heading,{className:"animated flipInX fast"},"Hello."),i.a.createElement("p",null,"Find or create your wallet."))),i.a.createElement(m.Columns,{className:"is-desktop is-centered"},i.a.createElement(m.Columns.Column,{size:"half"},i.a.createElement(k,{state:o,onChange:function(e){c({type:r.loginFormType,username:e.target.value,dispatch:c})}}),o.loading&&o.username&&i.a.createElement("div",null,i.a.createElement(m.Loader,{style:{width:25,height:25}}),i.a.createElement("p",{className:"animated flipInX fast"},o.loadingText)),!o.loading&&o.username&&o.userTree&&i.a.createElement(x,{state:o,dispatch:c,onLogin:E}),!o.loading&&o.username&&!o.userTree&&i.a.createElement(C,{state:o,dispatch:c,onLogin:E}))))}}).call(this,n(2).Buffer)},28:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r,a=n(5),o=n.n(a),c=n(18),l=n(12),s=n(8),u=n.n(s)()("appcommunity");function i(){return u("getAppCommunity"),void 0!==r?r:r=new Promise(function(){var e=Object(c.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0="production",e.next="production"===e.t0?3:8;break;case 3:return u("using production community"),e.next=6,l.Community.getDefault();case 6:return r=e.sent,e.abrupt("break",12);case 8:return u("using development community"),e.next=11,l.Community.freshLocalTestCommunity();case 11:r=e.sent;case 12:t(r);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}},32:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return O}));var r,a=n(5),o=n.n(a),c=n(18),l=n(7),s=n(173),u=n(22),i=n(0),m=n.n(i),d=n(12),p=n(28);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}if(window){var g=window.location.pathname;console.log("subDirectory ",g),"/"!==g&&(console.log("setting wasmpath to: ",g+"tupelo.wasm"),Go.setWasmPath(g+"tupelo.wasm"))}function v(e,t){switch(t.type){case r.loading:return b({},e,{loading:e.loading+1});case r.stopLoading:return b({},e,{loading:e.loading-1});case r.login:return b({},e,{userTree:t.userTree});case r.setDID:return b({},e,{userDid:t.did});case r.logout:return sessionStorage.removeItem("userDid"),sessionStorage.removeItem("userKey"),b({},E,{loading:0});case r.message:var n=t.message;return n.id=(new Date).toString()+"-"+n.title+Math.random().toString(),b({},e,{messages:[].concat(Object(s.a)(e.messages),[n])});case r.removeMessage:for(var a=t.id,o=-1,c=e.messages.length-1;c>=0;c--)if(e.messages[c].id===a){o=c;break}return-1===o?e:b({},e,{messages:[].concat(Object(s.a)(e.messages.slice(0,o)),Object(s.a)(e.messages.slice(o+1)))});default:throw new Error("unkown type: "+t.type)}}!function(e){e[e.loading=0]="loading",e[e.stopLoading=1]="stopLoading",e[e.login=2]="login",e[e.setDID=3]="setDID",e[e.removeMessage=4]="removeMessage",e[e.message=5]="message",e[e.logout=6]="logout"}(r||(r={}));var E={loading:1,messages:[]},h=Object(i.createContext)([E,function(){}]),O=function(t){var n=t.children,a=Object(i.useState)(!0),s=Object(l.a)(a,2),u=s[0],f=s[1],b=Object(i.useReducer)(v,E),g=Object(l.a)(b,2),O=g[0],y=g[1];return Object(i.useEffect)((function(){if(u){f(!1);var t=sessionStorage.getItem("userDid"),n=sessionStorage.getItem("userKey");t&&n?function(){var a=Object(c.a)(o.a.mark((function a(){var c,l,s,u;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t&&n){a.next=2;break}throw new Error("no did or no userKey");case 2:return a.next=4,Object(p.a)();case 4:return c=a.sent,a.prev=5,a.next=8,c.getTip(t);case 8:l=a.sent,a.next=17;break;case 11:if(a.prev=11,a.t0=a.catch(5),"not found"!==a.t0){a.next=16;break}return y({type:r.logout}),a.abrupt("return");case 16:throw a.t0;case 17:return a.next=19,d.EcdsaKey.fromBytes(e.from(n,"base64"));case 19:s=a.sent,u=new d.ChainTree({key:s,tip:l,store:c.blockservice}),console.log("logging in from storage"),y({type:r.login,userTree:u}),y({type:r.stopLoading});case 24:case"end":return a.stop()}}),a,null,[[5,11]])})));return function(){return a.apply(this,arguments)}}()():(console.log("stopping loading"),y({type:r.stopLoading}))}!O.userDid&&O.userTree&&O.userTree.id().then((function(e){y({type:r.setDID,did:e})})),O.userTree&&O.userDid&&O.userTree.key&&O.userTree.key.privateKey&&(sessionStorage.setItem("userDid",O.userDid),sessionStorage.setItem("userKey",e.from(O.userTree.key.privateKey).toString("base64"))),console.log({newState:O})}),[O,u]),m.a.createElement(h.Provider,{value:[O,y]},n)}}).call(this,n(2).Buffer)},500:function(e,t,n){e.exports=n(1204)},505:function(e,t,n){},506:function(e,t,n){},536:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=536},538:function(e,t){},540:function(e,t){},573:function(e,t){},574:function(e,t){},621:function(e,t){},69:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return d}));var r=n(5),a=n.n(r),o=n(18),c=n(12),l=n(28),s="/_wallet/username",u=e.from("_wallet-dev"),i=function(t){return c.EcdsaKey.passPhraseKey(e.from(t),u)},m=function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t);case 2:return n=e.sent,e.abrupt("return",c.Tupelo.ecdsaPubkeyToDid(n.publicKey));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.a)();case 2:return n=e.sent,e.next=5,m(t);case 5:return r=e.sent,e.prev=6,e.next=9,n.getTip(r);case 9:o=e.sent,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),e.t0;case 15:return e.abrupt("return",new c.ChainTree({store:n.blockservice,tip:o}));case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(2).Buffer)},717:function(e,t){}},[[500,1,2]]]);
//# sourceMappingURL=main.0d555bdb.chunk.js.map