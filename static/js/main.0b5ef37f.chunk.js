(window.webpackJsonpwallet=window.webpackJsonpwallet||[]).push([[0],{1101:function(e,t){},1103:function(e,t){},1178:function(e,t,n){e.exports=n.p+"static/media/logo.74ee5cb0.svg"},1179:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(275),c=n.n(o),l=(n(497),n(7)),s=(n(498),n(499),n(1)),u=n(276),i=n(30),m=n(491),d=n(43),f=n(25),p=n(5),b=n.n(p),g=n(14),v=n(10),E=n(21);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(r.useState)({loading:!1,tokenName:"",maximum:0}),u=Object(l.a)(c,2),i=u[0],m=u[1],d=function(e){m(O({},i,Object(f.a)({},e.target.name,e.target.value)))};return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Establish Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,i.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:i.tokenName,onChange:d,name:"tokenName",placeholder:"Token Name"}))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Maximum Mint"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{type:"number",value:i.maximum.toString(),onChange:d,name:"maximum",placeholder:"Maximum Mint"})),a.a.createElement(s.Form.Help,null,"Leave as 0 to allow unlimited minting")),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){m(O({},i,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.b)(o,[Object(v.establishTokenTransaction)(i.tokenName,i.maximum)]);case 2:m(O({},i,{loading:!1,tokenName:"",maximum:0})),n();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Establish"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var w=n(60);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x="/tree/_tupelo/tokens";function T(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,u=Object(r.useContext)(i.b),m=Object(l.a)(u,2)[1],d={loading:!1,tokenName:"",destination:"",amount:"",destinationError:"",amountError:""},p=Object(r.useState)(d),h=Object(l.a)(p,2),O=h[0],y=h[1],j=function(){return""!==O.destinationError},T=function(){return""!==O.amountError},C=function(e){y(k({},O,Object(f.a)({},e.target.name,e.target.value)))},F=Object.keys(c).map((function(e){return a.a.createElement("option",{key:e,value:e},e)}));return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Send Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,O.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Select,{onChange:C,value:O.tokenName,name:"tokenName"},a.a.createElement("option",{value:""}),F))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Destination"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{color:j()?"danger":"info",value:O.destination,onChange:C,name:"destination",placeholder:"Where to send"})),j()&&a.a.createElement(s.Form.Help,{color:"danger"},O.destinationError)),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Amount"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{color:T()?"danger":"info",type:"number",value:O.amount,onChange:C,name:"amount",placeholder:"Amount to send"})),T()&&a.a.createElement(s.Form.Help,{color:"danger"},O.amountError)),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){y(k({},O,{loading:!0,destinationError:"",amountError:""})),function(){var e=Object(g.a)(b.a.mark((function e(){var t,r,a,c,l,s,u,f,p,g,h,j,T,C,F;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sending: ",O),e.next=3,Object(E.a)();case 3:return t=e.sent,e.next=6,o.resolve(x+"/"+O.tokenName);case 6:if(r=e.sent,a=r.value.balance,!(parseInt(O.amount,10)>a)){e.next=11;break}return y((function(e){return k({},e,{amountError:"That's too much. You don't have that",loading:!1})})),e.abrupt("return");case 11:return e.prev=11,e.next=14,Object(w.a)(O.destination);case 14:c=e.sent,e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(11),"not found"!==e.t0){e.next=22;break}return y((function(e){return k({},e,{destinationError:"User not found",loading:!1})})),e.abrupt("return");case 22:throw e.t0;case 23:return e.next=25,v.EcdsaKey.generate();case 25:return l=e.sent,e.next=28,v.ChainTree.newEmptyTree(t.blockservice,l);case 28:return s=e.sent,e.next=31,o.id();case 31:return u=e.sent,e.next=34,c.id();case 34:return f=e.sent,e.next=37,s.id();case 37:if(p=e.sent,null!==u&&null!==f&&null!==p){e.next=40;break}throw new Error("error getting userdid, destdid or ephemeralDID");case 40:return console.log("ephemeralDID: ",p),e.next=43,o.resolve("tree/_tupelo/authentications");case 43:return g=e.sent,e.next=46,c.resolve("tree/_tupelo/authentications");case 46:return h=e.sent,j=u+"->"+f+Math.random().toString(),console.log("sending token to ephemeral"),T=Object(v.sendTokenTransaction)(j,O.tokenName,parseInt(O.amount,10),p),console.log("send tx: ",T.toObject()),e.next=53,t.sendTokenAndGetPayload(o,T);case 53:return C=e.sent,console.log("receiving on ephemeral, payload: ",C.toObject()),F=Object(v.receiveTokenTransactionFromPayload)(C),console.log("receiveTx: ",F.toObject()),e.next=59,Object(E.b)(s,[Object(v.setOwnershipTransaction)(g.value.concat(h.value)),F]);case 59:console.log("done"),y(d),n(),m({type:i.a.message,message:{title:"Sent "+O.amount+" token to user: "+O.destination,body:"Ask "+O.destination+" to use this DID in their receive token: \n"+p}});case 63:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(){return e.apply(this,arguments)}}()()}},"Send"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,u=Object(r.useState)({loading:!1,tokenName:"",amount:0}),i=Object(l.a)(u,2),m=i[0],d=i[1],p=function(e){d(F({},m,Object(f.a)({},e.target.name,e.target.value)))},h=Object.keys(c).map((function(e){return a.a.createElement("option",{key:e,value:e},e)}));return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Mint Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,m.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Token Name"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Select,{onChange:p,value:m.tokenName,name:"tokenName"},a.a.createElement("option",{value:""}),h))),a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"Amount"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{type:"number",value:m.amount.toString(),onChange:p,name:"amount",placeholder:"Amount to Mint"}))),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){d(F({},m,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.b)(o,[Object(v.mintTokenTransaction)(m.tokenName,m.amount)]);case 2:d(F({},m,{loading:!1,tokenName:"",amount:0})),n();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Mint"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var D=n(126),S=n(179),M=n(8),L=n.n(M)()("util:syncher"),I=function(){function e(t){Object(D.a)(this,e),this.queue=void 0,this.started=void 0,this.name=void 0,this.started=!1,this.queue=[],this.name=t}return Object(S.a)(e,[{key:"run",value:function(){var e=Object(g.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.queue.pop())){e.next=5;break}return L(this.name," stopping syncher"),this.started=!1,e.abrupt("return");case 5:return e.prev=5,L(this.name," run fn",t.fn.toString()),e.next=9,t.fn();case 9:n=e.sent,L(this.name," finish fn"),t.res(n),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),L(this.name," rejecting: ",e.t0),t.rej(e.t0);case 18:this.queue.length>0?(L(this.name,"syncher queueing another"),this.run()):this.started=!1;case 19:case"end":return e.stop()}}),e,this,[[5,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;return new Promise((function(n,r){if(t.queue.push({fn:e,res:n,rej:r}),!t.started)return L(t.name," not started, starting"),t.started=!0,void t.run();L(t.name," run already started")}))}}]),e}();function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A="/tree/_tupelo/tokens";function K(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(r.useState)({loading:!1,did:""}),u=Object(l.a)(c,2),i=u[0],m=u[1];return a.a.createElement(s.Modal,{show:t,onClose:n},a.a.createElement(s.Modal.Card,{style:{backgroundColor:"white"}},a.a.createElement(s.Modal.Card.Head,null,a.a.createElement(s.Modal.Card.Title,null,"Receive Token")),a.a.createElement(s.Modal.Card.Body,null,a.a.createElement(s.Media,null,i.loading?a.a.createElement(s.Loader,null):a.a.createElement(s.Media.Item,null,a.a.createElement(s.Content,null,a.a.createElement(s.Form.Field,null,a.a.createElement(s.Form.Label,null,"DID"),a.a.createElement(s.Form.Control,null,a.a.createElement(s.Form.Input,{value:i.did,onChange:function(e){m(N({},i,Object(f.a)({},e.target.name,e.target.value)))},name:"did",placeholder:"DID of tokens"})),a.a.createElement(s.Form.Help,null,"This is the code that begins with 'did:tupelo:' that the sender has from the wallet.\xe5")),a.a.createElement(s.Form.Field,{kind:"group"},a.a.createElement(s.Button,{color:"primary",onClick:function(){m(N({},i,{loading:!0})),function(){var e=Object(g.a)(b.a.mark((function e(){var t,r,a,c,l,s,u,d,f;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)();case 2:return t=e.sent,e.next=5,o.id();case 5:if(null!==(r=e.sent)){e.next=8;break}throw new Error("user tree had null id");case 8:return e.next=10,t.getTip(i.did);case 10:return a=e.sent,c=new v.ChainTree({store:t.blockservice,tip:a,key:o.key}),e.next=14,c.resolve(A);case 14:return l=e.sent,e.next=17,Promise.all(Object.keys(l.value||{}).map(function(){var e=Object(g.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.resolve(A+"/"+t);case 2:return n=e.sent,e.abrupt("return",{name:t,balance:n.value.balance});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:return s=e.sent,u=new I,e.next=21,Promise.all(s.map((function(e){return u.send((function(){return t.sendTokenAndGetPayload(c,Object(v.sendTokenTransaction)("uuid"+Math.random().toString(),e.name,e.balance,r))}))})));case 21:return d=e.sent,f=d.map((function(e){return Object(v.receiveTokenTransactionFromPayload)(e)})),e.next=25,Object(E.b)(o,f);case 25:m((function(e){return N({},e,{loading:!1,did:""})})),n();case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Receive"),a.a.createElement(s.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R="/tree/_tupelo/tokens";function U(e){var t=Object(r.useState)({loading:!0,tokens:{},showEstablishModal:!1,showMintModal:!1,showSendModal:!1,showReceiveModal:!1,modifiedAt:0}),n=Object(l.a)(t,2),o=n[0],c=n[1],u=Object(r.useContext)(i.b),m=Object(l.a)(u,1)[0];if(Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==m.userTree){e.next=2;break}throw new Error("user tree must be defined");case 2:return e.prev=2,e.next=5,m.userTree.resolve(R);case 5:t=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("e: ",e.t0),c((function(e){return _({},e,{tokens:{},loading:!1})}));case 12:console.log("tokens resp: ",t),c((function(e){return _({},e,{tokens:t.value||{},loading:!1})}));case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();console.log("loading tokens"),e()}),[m.userTree,o.modifiedAt]),!m.userTree)return a.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}});if(o.loading)return a.a.createElement(s.Loader,null);var f=Object.keys(o.tokens).map((function(e){if(void 0===m.userTree)throw new Error("undefined user tree!");return a.a.createElement(z,{key:e,modifiedAt:o.modifiedAt,tree:m.userTree,tokenName:e})})),p=function(){console.log("setting modifiedAt"),c((function(e){return _({},e,{modifiedAt:Date.now()})}))};return a.a.createElement("div",null,a.a.createElement(y,{userTree:m.userTree,show:o.showEstablishModal,onClose:function(){p(),c(_({},o,{showEstablishModal:!1}))}}),a.a.createElement(P,{tokens:o.tokens,userTree:m.userTree,show:o.showMintModal,onClose:function(){p(),c(_({},o,{showMintModal:!1}))}}),a.a.createElement(T,{tokens:o.tokens,userTree:m.userTree,show:o.showSendModal,onClose:function(){p(),c(_({},o,{showSendModal:!1}))}}),a.a.createElement(K,{userTree:m.userTree,show:o.showReceiveModal,onClose:function(){p(),c(_({},o,{showReceiveModal:!1}))}}),a.a.createElement(s.Level,null,a.a.createElement(s.Level.Side,{align:"left"},a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showSendModal:!0}))}},"Send Token")),a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showReceiveModal:!0}))}},"Receive Token")))),a.a.createElement(s.Table,null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Name"),a.a.createElement("th",null,"Balance"),a.a.createElement("th",null,"Max"))),a.a.createElement("tbody",null,f)),a.a.createElement(s.Level,null,a.a.createElement(s.Level.Side,{align:"left"},a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showEstablishModal:!0}))}},"Establish Token")),a.a.createElement(s.Level.Item,null,a.a.createElement(s.Button,{onClick:function(){c(_({},o,{showMintModal:!0}))}},"Mint Token")))))}var q,z=function(e){var t=e.tree,n=e.tokenName,o=e.modifiedAt,c=Object(r.useState)({balance:0,max:null,loading:!0}),u=Object(l.a)(c,2),i=u[0],m=u[1];return Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(b.a.mark((function e(){var r,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=R+"/"+n,e.next=3,t.resolve(r);case 3:if(a=e.sent,console.log("tokenInfoResp ",r,a),!a.value.monetaryPolicy){e.next=10;break}return e.next=8,t.resolve(r+"/monetaryPolicy");case 8:o=e.sent,m((function(e){return _({},e,{max:o.value.maximum})}));case 10:m((function(e){return _({},e,{balance:a.value.balance,loading:!1})}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();console.log("loading tokenRow"),e()}),[t,n,o]),a.a.createElement("tr",null,a.a.createElement("td",null,n),a.a.createElement("td",null,i.loading?a.a.createElement(s.Loader,null):i.balance),a.a.createElement("td",null,i.loading?a.a.createElement(s.Loader,null):i.max))},W=n(488),V=n(489);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){var t=Object(r.useState)({currentTab:q.objects}),n=Object(l.a)(t,2),o=n[0],c=n[1],u=Object(r.useContext)(i.b),m=Object(l.a)(u,1)[0],p=function(e){var t=e.target.innerText.toLowerCase();c(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o,{currentTab:q[t]}))};return m.userTree?a.a.createElement(s.Container,null,a.a.createElement(s.Tabs,{type:"boxed"},a.a.createElement(s.Tabs.Tab,{onClick:p,active:o.currentTab===q.objects},"Objects"),a.a.createElement(s.Tabs.Tab,{onClick:p,active:o.currentTab===q.tokens},"Tokens"),a.a.createElement(s.Tabs.Tab,{onClick:p,active:o.currentTab===q.creator},"Creator")),function(e){if(void 0===m.userTree)throw new Error("can't get page content without a usertree");switch(e){case q.tokens:return a.a.createElement(U,null);case q.creator:return a.a.createElement(W.a,{userTree:m.userTree});case q.objects:return a.a.createElement(V.a,null);default:throw new Error("unrecognized tab: "+e)}}(o.currentTab)):a.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}})}function Y(){var e=Object(r.useContext)(i.b),t=Object(l.a)(e,1)[0].messages.map((function(e){return a.a.createElement(Z,{message:e})}));return a.a.createElement(s.Container,null,a.a.createElement("ol",{style:{listStyleType:"none"}},t))}!function(e){e[e.objects=0]="objects",e[e.tokens=1]="tokens",e[e.creator=2]="creator"}(q||(q={}));var Z=function(e){var t=e.message,n=Object(r.useContext)(i.b),o=Object(l.a)(n,2)[1];if(void 0===t.id)throw new Error("a message must have an id when it's in the list");return a.a.createElement("li",{key:t.id},a.a.createElement(s.Message,{color:"info"},a.a.createElement(s.Message.Header,null,t.title,a.a.createElement(s.Button,{remove:!0,onClick:function(){o({type:i.a.removeMessage,id:t.id})}})),a.a.createElement(s.Message.Body,{style:{whiteSpace:"pre"}},t.body)))},X=function(){var e=Object(r.useContext)(i.b);return Object(l.a)(e,1)[0].loading>0?a.a.createElement(s.Section,null,a.a.createElement(s.Columns,{className:"is-desktop"},a.a.createElement(s.Loader,{style:{height:100,width:100}}))):a.a.createElement("div",null,a.a.createElement(Y,null),a.a.createElement(m.a,null,a.a.createElement(d.d,null,a.a.createElement(d.b,{path:"/login"},a.a.createElement(u.a,null)),a.a.createElement(d.b,{path:"/wallet"},a.a.createElement(J,null)),a.a.createElement(d.b,null,a.a.createElement(u.a,null)))))},$=function(){var e=Object(r.useContext)(i.b),t=Object(l.a)(e,1)[0];return a.a.createElement(s.Navbar,{transparent:!1},a.a.createElement(s.Navbar.Brand,null,a.a.createElement("img",{src:n(1178),alt:"Tupelo"})),a.a.createElement(s.Navbar.Container,{position:"end"},t&&t.username&&a.a.createElement("p",null,"Wallet of ",t.username)))},Q=function(){return a.a.createElement(i.c,null,a.a.createElement(s.Container,null,a.a.createElement($,null)),a.a.createElement(s.Container,null,a.a.createElement(s.Section,null,a.a.createElement(X,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},21:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p}));var r,a=n(5),o=n.n(a),c=n(14),l=n(10),s=n(29),u=n.n(s),i=n(8),m=n.n(i)()("appcommunity"),d='\nid = "tupelolocal"\nBootstrapAddresses = [\n    "/ip4/127.0.0.1/tcp/34001/ipfs/16Uiu2HAm3TGSEKEjagcCojSJeaT5rypaeJMKejijvYSnAjviWwV5",\n    "/ip4/127.0.0.1/tcp/50000/ws/ipfs/16Uiu2HAm4hjC7zZTSN5KAp187vn52bZMsC8VaVdtrci7HD4aZcU7",\n]\n[[signers]]\nVerKeyHex = "0x15796b266a7d6b7c6b29c5bf97ad376fe8457e4d56bb0612ec8703c65ca7b6bb5dca004d55f5238d7764cd100c9e9cac3c5abce902bae8a5f9c29de716a145595b071b1b7038a48b4f6f88e7664b38c02062f64b3ceb499e4cbb82361457dcd731f5b48901871e7fd56a9c91ab3e06d3f7cb27288962686d9a05e02c1482f01f"\nDestKeyHex = "0x04f6dee3f7da1da58afd6ee58ea6b858fb67664fc6e2240bb6e3a75c0e1db9bbef5f413c8604bb864513d3cf27eca60b539b048b2a08f8799570c14dfb73f3f391"\n\n[[signers]]\nVerKeyHex = "0x7be8c92c8c295ef3e97be28f469f5f94d10ee7db4d202776bee5cf55c62d508a0c3550a19342d768ff073c0798ce003646df586ef588a9e9443a0ca86a234ed15150dc98ecc3f1071649fca03426f1c8c215a90752f51faa3e2e788e1dae2e9e5cf87c1ca4239a0949a0ba6ea09c061a538372cc4230dedafae929b170ad7704"\nDestKeyHex = "0x0438b196bddb9c3ec395b8ccb07bdab44ec768c084e7141b09ac5638d47fffbd5e7b7623f499a2e714e31464a356a0e30ad7c93045b6cd9957b45e957cc15dcb99"\n\n[[signers]]\nVerKeyHex = "0x88aefad94805db01cacaf190f47bc9e40f584b5085c651da168ac4034d570b4750bf7b23803d204e483e407a5ca34ee7f7a434733346451cf3f5d26c0d11e5ac45398a03fbba2d3b0dfc21cdf14615430cea394bd9423d8527eaa82a96aa6d20655724d99770ee3488b6537d6be143b84b21ad5ee12c190048757fe453313fd2"\nDestKeyHex = "0x0468924bd1341b5cec1fed888aaf1e3caa94e7d0f13d4f4573b01b296374b9e710a58a7b40e7161c0bcf7fd41832441ca21076f3846e854c8d8c640f2469a552b1"\n';function f(){return m("getAppCommunity"),void 0!==r?r:r=new Promise(function(){var e=Object(c.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0="production",e.next="production"===e.t0?3:8;break;case 3:return m("using production community"),e.next=6,l.Community.getDefault();case 6:return r=e.sent,e.abrupt("break",13);case 8:return m("using development community"),e.next=11,l.Community.fromNotaryGroupToml(d);case 11:r=e.sent,l.Community.setDefault(r);case 13:t(r);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function p(e,t){return b.apply(this,arguments)}function b(){return(b=Object(c.a)(o.a.mark((function t(n,r){var a,c,l,s,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f();case 2:return a=t.sent,t.next=5,a.playTransactions(n,r);case 5:if(c=t.sent,void 0!==(l=c.getSignature())){t.next=9;break}throw new Error("undefined sig from response");case 9:return s=new u.a(e.from(l.getNewTip_asU8())),t.next=12,n.id();case 12:if(null!==(i=t.sent)){t.next=15;break}throw new Error("error getting ID, was null");case 15:return t.next=17,g(i,s);case 17:return t.abrupt("return",c);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(e,t){return new Promise((function(n,r){m("waiting for community on ",e);var a=0,l=function(){var s=Object(c.a)(o.a.mark((function c(){var s,u;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,f();case 2:return s=o.sent,m("waitForCommunityTip: awaitng nextUpdate"),o.next=6,s.nextUpdate();case 6:return m("waitForCommunityTip: getTip"),o.prev=7,o.next=10,s.getTip(e);case 10:u=o.sent,o.next=19;break;case 13:if(o.prev=13,o.t0=o.catch(7),"not found"!==o.t0){o.next=18;break}return setTimeout(l,200),o.abrupt("return");case 18:throw new Error(o.t0);case 19:if(!t.equals(u)){o.next=23;break}return m("tips matched",e),n(),o.abrupt("return");case 23:if(!(a>60)){o.next=27;break}return m("waitForCommunityTip: rejecting timeout ",e),r(new Error("timeout error, over 30s")),o.abrupt("return");case 27:a++,m("tips did not match, retrying",e),setTimeout(l,500);case 30:case"end":return o.stop()}}),c,null,[[7,13]])})));return function(){return s.apply(this,arguments)}}();l()}))}}).call(this,n(2).Buffer)},210:function(e,t){},276:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return F}));var r,a=n(7),o=n(25),c=n(5),l=n.n(c),s=n(14),u=n(0),i=n.n(u),m=n(1),d=n(21),f=n(10),p=n(43),b=n(30),g=n(60);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.loginFormType=0]="loginFormType",e[e.passwordFormType=1]="passwordFormType",e[e.userTree=2]="userTree",e[e.registering=3]="registering",e[e.loggingIn=4]="loggingIn"}(r||(r={}));var h,O={loading:!1,username:"",password:"",loadingText:""},y=function(e,t){var n=function(){var n=Object(s.a)(l.a.mark((function n(){var a,o,c,s,u,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(d.a)();case 2:if(a=n.sent,o=e.username){n.next=6;break}return n.abrupt("return");case 6:return console.log("actually checking: ",o),n.next=9,Object(g.b)(o);case 9:return c=n.sent,n.next=12,f.Tupelo.ecdsaPubkeyToDid(c.publicKey);case 12:return s=n.sent,i=void 0,n.prev=14,n.next=17,a.getTip(s);case 17:u=n.sent,n.next=23;break;case 20:n.prev=20,n.t0=n.catch(14),n.t0;case 23:void 0!==u&&(i=new f.ChainTree({store:a.blockservice,tip:u})),t({type:r.userTree,username:o,tree:i,dispatch:t}),h=void 0;case 26:case"end":return n.stop()}}),n,null,[[14,20]])})));return function(){return n.apply(this,arguments)}}();clearTimeout(h),h=setTimeout(n,150)};function w(e,t){switch(t.type){case r.loginFormType:var n=t.username;return y(e,t.dispatch),E({},e,{loading:!0,loginText:"Checking for username availability",username:n});case r.userTree:var a=t;return console.log("user tree received: ",a.username," state: ",e.username),a.username!==e.username?(y(e,a.dispatch),e):E({},e,{loading:!1,loadingText:"",userTree:t.tree});case r.passwordFormType:return E({},e,{password:t.password});case r.registering:return E({},e,{loading:!0,loadingText:"Registering your user"});case r.loggingIn:return E({},e,{loading:!0,loadingText:"Logging in"});default:throw new Error("unkown type: "+t.type)}}var j=function(e){return!e.loading&&e.username&&!e.userTree};function k(e){var t=e.state,n=e.onChange;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Username"),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{color:j(t)?"success":"info",type:"text",placeholder:"Username",value:t.username,onChange:n}),t.loading?i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-spinner fa-pulse"})):i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-user"}))),j(t)&&i.a.createElement(m.Form.Help,{color:"success"},"This username is available"))}function x(e){var t=e.name,n=e.value,r=e.onChange,a=e.error;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,t),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{className:a?"animated pulse faster":"",color:a?"danger":"info",type:"password",placeholder:"Password",value:n,onChange:r}),i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-key"}))),a&&i.a.createElement(m.Form.Help,{color:"danger"},a))}function T(t){var n=t.state,r=(t.dispatch,t.onLogin),o=Object(u.useState)(""),c=Object(a.a)(o,2),d=c[0],p=c[1],b=Object(u.useState)(""),g=Object(a.a)(b,2),v=g[0],E=g[1],h=function(){var t=Object(s.a)(l.a.mark((function t(){var a,o,c,s,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n.userTree){t.next=2;break}throw new Error("must have a user tree to login");case 2:return a=n.userTree,o=n.username,t.next=6,f.EcdsaKey.passPhraseKey(e.from(d),e.from(o));case 6:return c=t.sent,t.next=9,f.Tupelo.ecdsaPubkeyToAddress(c.publicKey);case 9:return s=t.sent,t.next=12,a.resolve("tree/_tupelo/authentications");case 12:u=t.sent,u.value.includes(s)?(a.key=c,r(n.userTree)):E("invalid password");case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement(x,{error:v,name:"Password",value:d,onChange:function(e){E(""),p(e.target.value)}}),i.a.createElement(m.Button,{onClick:h},"Login"))}function C(t){var n=t.state,o=t.dispatch,c=t.onLogin,p=Object(u.useState)(""),b=Object(a.a)(p,2),v=b[0],E=b[1],h=Object(u.useState)(""),O=Object(a.a)(h,2),y=O[0],w=O[1],j=Object(u.useState)(""),k=Object(a.a)(j,2),T=k[0],C=k[1];return i.a.createElement("div",null,i.a.createElement(x,{error:T,name:"Password",value:v,onChange:function(e){C(""),E(e.target.value)}}),i.a.createElement(x,{error:T,name:"Confirm Password",value:y,onChange:function(e){C(""),w(e.target.value)}}),i.a.createElement(m.Button,{onClick:function(){v===y?(o({type:r.registering}),function(){var t=Object(s.a)(l.a.mark((function t(){var r,a,o,s,u,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.username,t.next=3,Object(g.b)(r);case 3:return a=t.sent,t.next=6,f.EcdsaKey.passPhraseKey(e.from(v),e.from(r));case 6:return o=t.sent,t.next=9,f.Tupelo.ecdsaPubkeyToAddress(o.publicKey);case 9:return s=t.sent,t.next=12,Object(d.a)();case 12:return u=t.sent,t.next=15,f.ChainTree.newEmptyTree(u.blockservice,a);case 15:return i=t.sent,console.log("playing transactions"),t.next=19,Object(d.b)(i,[Object(f.setOwnershipTransaction)([s]),Object(f.setDataTransaction)(g.c,r)]);case 19:i.key=o,c(i);case 21:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()):C("Passwords do not match")}},"Register"))}function F(e){var t=Object(u.useReducer)(w,O),n=Object(a.a)(t,2),o=n[0],c=n[1],d=Object(u.useState)(!1),f=Object(a.a)(d,2),g=f[0],v=f[1],E=Object(u.useContext)(b.b),h=Object(a.a)(E,2)[1],y=function(){var e=Object(s.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.id();case 2:n=e.sent,h({type:b.a.login,userTree:t,username:o.username,did:n}),v(!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=(e.location&&e.location.state?e.location.state:{from:{pathname:"/wallet"}}).from;return g?i.a.createElement(p.a,{to:j}):i.a.createElement("div",null,i.a.createElement(m.Columns,{className:"is-desktop"},i.a.createElement(m.Columns.Column,{size:"half"},i.a.createElement(m.Heading,{className:"animated flipInX fast"},"Hello."),i.a.createElement(m.Heading,{subtitle:!0},"Find or create your wallet."))),i.a.createElement(m.Columns,{className:"is-desktop"},i.a.createElement(m.Columns.Column,{size:"half"},i.a.createElement(k,{state:o,onChange:function(e){c({type:r.loginFormType,username:e.target.value,dispatch:c})}}),o.loading&&o.username&&i.a.createElement("div",null,i.a.createElement(m.Loader,{style:{width:25,height:25}}),i.a.createElement("p",{className:"animated flipInX fast"},o.loadingText)),!o.loading&&o.username&&o.userTree&&i.a.createElement(T,{state:o,dispatch:c,onLogin:y}),!o.loading&&o.username&&!o.userTree&&i.a.createElement(C,{state:o,dispatch:c,onLogin:y}))))}}).call(this,n(2).Buffer)},30:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return y}));var r,a=n(5),o=n.n(a),c=n(14),l=n(7),s=n(180),u=n(25),i=n(0),m=n.n(i),d=n(10),f=n(21),p=n(60);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}if(window){var v=window.location.pathname;console.log("subDirectory ",v),"/"!==v&&(console.log("setting wasmpath to: ",v+"tupelo.wasm"),Go.setWasmPath(v+"tupelo.wasm"))}function E(e,t){var n;switch(t.type){case r.loading:return g({},e,{loading:e.loading+1});case r.stopLoading:return g({},e,{loading:e.loading-1});case r.login:return g({},e,{userTree:(n=t).userTree,username:n.username,did:n.did});case r.setDID:return g({},e,{userDid:t.did});case r.setUsername:return g({},e,{username:t.username});case r.logout:return sessionStorage.removeItem("userDid"),sessionStorage.removeItem("userKey"),g({},h,{loading:0});case r.message:var a=t.message;return a.id=(new Date).toString()+"-"+a.title+Math.random().toString(),g({},e,{messages:[].concat(Object(s.a)(e.messages),[a])});case r.removeMessage:for(var o=t.id,c=-1,l=e.messages.length-1;l>=0;l--)if(e.messages[l].id===o){c=l;break}return-1===c?e:g({},e,{messages:[].concat(Object(s.a)(e.messages.slice(0,c)),Object(s.a)(e.messages.slice(c+1)))});default:throw new Error("unkown type: "+t.type)}}!function(e){e[e.loading=0]="loading",e[e.stopLoading=1]="stopLoading",e[e.login=2]="login",e[e.setDID=3]="setDID",e[e.removeMessage=4]="removeMessage",e[e.message=5]="message",e[e.logout=6]="logout",e[e.setUsername=7]="setUsername"}(r||(r={}));var h={loading:1,messages:[]},O=Object(i.createContext)([h,function(){}]),y=function(t){var n=t.children,a=Object(i.useState)(!0),s=Object(l.a)(a,2),u=s[0],b=s[1],g=Object(i.useReducer)(E,h),v=Object(l.a)(g,2),y=v[0],w=v[1];return Object(i.useEffect)((function(){if(u){b(!1),Object(f.a)();var t=sessionStorage.getItem("userDid"),n=sessionStorage.getItem("userKey");t&&n?function(){var a=Object(c.a)(o.a.mark((function a(){var c,l,s,u,i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t&&n){a.next=2;break}throw new Error("no did or no userKey");case 2:return a.next=4,Object(f.a)();case 4:return c=a.sent,a.prev=5,a.next=8,c.getTip(t);case 8:l=a.sent,a.next=17;break;case 11:if(a.prev=11,a.t0=a.catch(5),"not found"!==a.t0){a.next=16;break}return w({type:r.logout}),a.abrupt("return");case 16:throw a.t0;case 17:return a.next=19,d.EcdsaKey.fromBytes(e.from(n,"base64"));case 19:return s=a.sent,u=new d.ChainTree({key:s,tip:l,store:c.blockservice}),a.next=23,u.resolveData(p.c);case 23:i=a.sent.value,console.log("logging in from storage: ",i," did: ",t),w({type:r.login,userTree:u,did:t,username:i}),w({type:r.stopLoading});case 27:case"end":return a.stop()}}),a,null,[[5,11]])})));return function(){return a.apply(this,arguments)}}()():(console.log("stopping loading"),w({type:r.stopLoading}))}!y.userDid&&y.userTree&&y.userTree.id().then((function(e){w({type:r.setDID,did:e})})),y.userTree&&y.userDid&&y.userTree.key&&y.userTree.key.privateKey&&(sessionStorage.setItem("userDid",y.userDid),sessionStorage.setItem("userKey",e.from(y.userTree.key.privateKey).toString("base64"))),console.log({newState:y})}),[y,u]),m.a.createElement(O.Provider,{value:[y,w]},n)}}).call(this,n(2).Buffer)},488:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b}));var r=n(5),a=n.n(r),o=n(25),c=n(14),l=n(7),s=n(0),u=n.n(s),i=n(1),m=n(10),d=n(21);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(t){var n=t.userTree,r={title:"",subtitle:"",content:"",imagePath:"",imageError:""},f=Object(s.useRef)(null),b=Object(s.useState)(r),g=Object(l.a)(b,2),v=g[0],E=g[1],h=Object(s.useState)(!1),O=Object(l.a)(h,2),y=O[0],w=O[1],j=function(){return""!==v.imagePath};function k(){return(k=Object(c.a)(a.a.mark((function t(){var o,c,s,u,i,b,g,h,O,y,k,x,T,C,F,P,D,S,M,L;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=p({},v),void 0!==n.key){t.next=3;break}throw new Error("undefined userTree key");case 3:if(c=void 0,!j()){t.next=10;break}if(null!==f.current&&null!==f.current.files){t.next=7;break}throw new Error("undefined ref, even though imagePath set");case 7:s=new FileReader,u=f.current.files[0],c=new Promise((function(e,t){s.onload=function(){var n=s.result;n.byteLength>307200?t("Your image is too big, please limit to 300k"):e(n)},s.onerror=function(e){t(e)},s.readAsArrayBuffer(u)}));case 10:return i=m.EcdsaKey.generate(),b=Object(d.a)(),t.next=14,Promise.all([i,b]);case 14:return g=t.sent,h=Object(l.a)(g,2),O=h[0],y=h[1],k=m.ChainTree.newEmptyTree(y.blockservice,O),x=m.Tupelo.ecdsaPubkeyToAddress(n.key.publicKey),t.next=22,Promise.all([k,x]);case 22:return T=t.sent,C=Object(l.a)(T,2),F=C[0],P=C[1],t.next=28,F.id();case 28:if(null!==(D=t.sent)){t.next=31;break}throw new Error("unknown tree DID");case 31:if(S={title:o.title,subtitle:o.subtitle,content:o.content},!j()||void 0===c){t.next=47;break}return console.log("has image, getting the bits"),t.prev=34,t.t0=e,t.next=38,c;case 38:t.t1=t.sent,S.image=t.t0.from.call(t.t0,t.t1),t.next=47;break;case 42:return t.prev=42,t.t2=t.catch(34),E((function(e){return p({},e,{imageError:t.t2.toString()})})),w(!1),t.abrupt("return");case 47:return console.log("creating attrs: ",S),M=Object(d.b)(F,[Object(m.setDataTransaction)("/_wallet/attributes",S),Object(m.setOwnershipTransaction)([P])]),L=Object(d.b)(n,[Object(m.setDataTransaction)("/_wallet/nfts/"+D,Date.now())]),t.next=52,Promise.all([M,L]);case 52:E(r),w(!1);case 54:case"end":return t.stop()}}),t,null,[[34,42]])})))).apply(this,arguments)}var x=function(e){var t=e.target;console.log("setting ",t.name," to ",t.value),E(p({},v,Object(o.a)({},t.name,t.value)))};return u.a.createElement("div",null,y?u.a.createElement(i.Loader,null):u.a.createElement(i.Box,{style:{marginTop:"1em"}},u.a.createElement(i.Form.Field,null,u.a.createElement(i.Form.Label,null,"Title"),u.a.createElement(i.Form.Control,null,u.a.createElement(i.Form.Input,{value:v.title,onChange:x,name:"title",placeholder:"title"}))),u.a.createElement(i.Form.Field,null,u.a.createElement(i.Form.Label,null,"Subtitle"),u.a.createElement(i.Form.Control,null,u.a.createElement(i.Form.Input,{value:v.subtitle,onChange:x,name:"subtitle",placeholder:"subtitle"}))),u.a.createElement(i.Form.Field,null,u.a.createElement(i.Form.Label,null,"Content"),u.a.createElement(i.Form.Control,null,u.a.createElement(i.Form.Input,{value:v.content,onChange:x,name:"content",placeholder:"content"}))),u.a.createElement(i.Form.Field,null,u.a.createElement(i.Form.Label,null,"Image (optional)"),u.a.createElement(i.Form.Control,null,u.a.createElement("input",{accept:"image/*",ref:f,onChange:x,name:"imagePath",type:"file"}),""!==v.imageError&&u.a.createElement(i.Form.Help,{color:"danger"},v.imageError))),u.a.createElement(i.Button,{onClick:function(){w(!0),function(){k.apply(this,arguments)}()}},"Create")))}}).call(this,n(2).Buffer)},489:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var r=n(490),a=n(5),o=n.n(a),c=n(25),l=n(14),s=n(7),u=n(0),i=n.n(u),m=n(1),d=n(30),f=n(10),p=n(21),b=n(60);function g(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(t){var n=t.did,a=t.onSend,c=t.userTree,v=Object(u.useContext)(d.b),h=Object(s.a)(v,2)[1],O=Object(u.useState)({loading:!0,tree:void 0,attrs:{},sending:!1,destination:"",destinationError:""}),y=Object(s.a)(O,2),w=y[0],j=y[1],k=function(){return""!==w.destinationError};Object(u.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t,r,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.a)();case 2:return t=e.sent,e.next=5,t.getTip(n);case 5:return r=e.sent,a=new f.ChainTree({store:t.blockservice,tip:r}),e.next=9,a.resolveData("/_wallet/attributes");case 9:c=e.sent,console.log(c.value),j((function(e){return E({},e,{loading:!1,tree:a,attrs:c.value||{}})}));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[n]);return i.a.createElement(m.Card,null,w.attrs.image?i.a.createElement(m.Card.Image,{src:"data:image/*;base64,"+e.from(w.attrs.image).toString("base64")}):i.a.createElement(m.Card.Header,null,i.a.createElement(m.Card.Header.Title,null,w.attrs.title)),i.a.createElement(m.Card.Content,null,w.loading?i.a.createElement(m.Loader,null):i.a.createElement("div",null,i.a.createElement(m.Media,null,i.a.createElement(m.Media.Item,null,i.a.createElement(m.Heading,{size:4},w.attrs.title),i.a.createElement(m.Heading,{subtitle:!0,size:6},w.attrs.subtitle))),i.a.createElement(m.Content,null,w.attrs.content,i.a.createElement("pre",{style:{marginTop:"1em"}},n)))),i.a.createElement(m.Card.Footer,null,w.sending?i.a.createElement(m.Content,{style:{padding:"1em"}},i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Destination Name"),i.a.createElement(m.Form.Control,null,i.a.createElement(m.Form.Input,{color:k()?"danger":"info",value:w.destination,onChange:function(e){j(E({},w,{destination:e.target.value}))},name:"nftdestination",placeholder:"Destination"})),k()&&i.a.createElement(m.Form.Help,{color:"danger"},w.destinationError)),i.a.createElement(m.Form.Field,{kind:"group"},i.a.createElement(m.Button,{color:"primary",onClick:function(){j(E({},w,{loading:!0,sending:!1,destinationError:""})),function(){var e=Object(l.a)(o.a.mark((function e(){var t,l,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==w.tree){e.next=2;break}throw new Error("card must have a tree to send");case 2:return e.prev=2,e.next=5,Object(b.a)(w.destination);case 5:t=e.sent,e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not found"!==e.t0){e.next=13;break}return j((function(e){return E({},e,{loading:!1,sending:!0,destinationError:"Unknown username"})})),e.abrupt("return");case 13:throw e.t0;case 14:return e.next=16,t.resolve("tree/_tupelo/authentications");case 16:return l=e.sent,w.tree.key=c.key,console.log("reassigning ",n," to: ",w.destination),e.next=21,Object(p.b)(w.tree,[Object(f.setOwnershipTransaction)(l.value)]);case 21:return console.log("remove did from nfts"),e.next=24,c.resolveData("/_wallet/nfts");case 24:return s=e.sent.value,s[n],u=Object(r.a)(s,[n].map(g)),e.next=28,Object(p.b)(c,[Object(f.setDataTransaction)("/_wallet/nfts",u)]);case 28:j((function(e){return E({},e,{sending:!1,loading:!1,destinationError:""})})),h({type:d.a.message,message:{title:"Sent an NFT to user: "+w.destination,body:"Ask "+w.destination+" to use this DID in their Add: \n"+n}}),a({did:n,tree:w.tree,destination:w.destination,dids:u});case 31:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}()()}},"Send"),i.a.createElement(m.Button,{text:!0,onClick:function(){j(E({},w,{sending:!1,destination:""}))}},"cancel"))):i.a.createElement(m.Card.Footer.Item,null,i.a.createElement(m.Button,{onClick:function(){j(E({},w,{sending:!0}))}},"Send"))))}function O(){var e=Object(u.useContext)(d.b),t=Object(s.a)(e,1)[0],n=Object(u.useState)({loading:!0,dids:{}}),r=Object(s.a)(n,2),a=r[0],f=r[1];if(void 0===t.userTree)throw new Error("must have a userTree to use ObjectWallet");var p=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f((function(e){return E({},e,{dids:t.dids})}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(u.useEffect)((function(){var e=function(){var e=Object(l.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.userTree){e.next=2;break}throw new Error("user tree has to be defined");case 2:return e.next=4,t.userTree.resolveData("/_wallet/nfts");case 4:n=e.sent,f((function(e){return E({},e,{loading:!1,dids:n.value||{}})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.userTree&&e()}),[t.userTree]);var b=Object.keys(a.dids).map((function(e){if(void 0===t.userTree)throw new Error("must hae a user tree to list dids");return i.a.createElement(m.Columns.Column,{key:e,size:3},i.a.createElement(h,{userTree:t.userTree,onSend:p,did:e}))}));return i.a.createElement("div",null,i.a.createElement(m.Columns,null,a.loading&&i.a.createElement(m.Loader,null),b),i.a.createElement(y,{onAdd:function(e){f((function(t){return E({},t,{dids:E({},a.dids,Object(c.a)({},e,Date.now()))})}))},userTree:t.userTree}))}var y=function(e){var t=e.userTree,n=e.onAdd,r=Object(u.useState)({addOpen:!1,addDid:"",addLoading:!1}),a=Object(s.a)(r,2),c=a[0],d=a[1],b=function(){d(E({},c,{addLoading:!0}));var e=c.addDid;(function(){var r=Object(l.a)(o.a.mark((function r(){var a,l,s,u,i;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==t&&void 0!==t.key){r.next=2;break}throw new Error("user tree undfined");case 2:return r.next=4,Object(p.a)();case 4:return a=r.sent,r.next=7,a.getTip(e);case 7:return l=r.sent,s=new f.ChainTree({store:a.blockservice,tip:l}),r.next=11,f.Tupelo.ecdsaPubkeyToAddress(t.key.publicKey);case 11:return u=r.sent,r.next=14,s.resolve("tree/_tupelo/authentications");case 14:if(i=r.sent,!i.value.includes(u)){r.next=21;break}return r.next=19,Object(p.b)(t,[Object(f.setDataTransaction)("/_wallet/nfts/"+e,Date.now())]);case 19:n(e),d(E({},c,{addLoading:!1,addDid:""}));case 21:d(E({},c,{addLoading:!1,addDid:"",addOpen:!1}));case 22:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()()};return i.a.createElement("div",null,c.addOpen?i.a.createElement((function(){return c.addLoading?i.a.createElement(m.Loader,null):i.a.createElement(m.Box,null,i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Add"),i.a.createElement(m.Form.Control,null,i.a.createElement(m.Form.Input,{value:c.addDid,onChange:function(e){d(E({},c,{addDid:e.target.value}))},name:"additionalDid",placeholder:"DID"}))),i.a.createElement(m.Form.Field,{kind:"group"},i.a.createElement(m.Button,{onClick:b,color:"primary"},"Add"),i.a.createElement(m.Button,{text:!0,onClick:function(){d((function(e){return E({},e,{addOpen:!1,addDid:""})}))}},"Cancel")))}),null):i.a.createElement(m.Button,{onClick:function(){d((function(e){return E({},e,{addOpen:!0})}))}},"Add"))}}).call(this,n(2).Buffer)},492:function(e,t,n){e.exports=n(1179)},497:function(e,t,n){},499:function(e,t,n){},528:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=528},530:function(e,t){},532:function(e,t){},565:function(e,t){},566:function(e,t){},60:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return d}));var r=n(5),a=n.n(r),o=n(14),c=n(10),l=n(21),s="/_wallet/username",u=e.from("_wallet-dev"),i=function(t){return c.EcdsaKey.passPhraseKey(e.from(t),u)},m=function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t);case 2:return n=e.sent,e.abrupt("return",c.Tupelo.ecdsaPubkeyToDid(n.publicKey));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.a)();case 2:return n=e.sent,e.next=5,m(t);case 5:return r=e.sent,e.prev=6,e.next=9,n.getTip(r);case 9:o=e.sent,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),e.t0;case 15:return e.abrupt("return",new c.ChainTree({store:n.blockservice,tip:o}));case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(2).Buffer)},613:function(e,t){},711:function(e,t){}},[[492,1,2]]]);
//# sourceMappingURL=main.0b5ef37f.chunk.js.map