(this.webpackJsonpwallet=this.webpackJsonpwallet||[]).push([[0],{1105:function(e,t){},1107:function(e,t){},1182:function(e,t,n){e.exports=n.p+"static/media/logo.74ee5cb0.svg"},1183:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(278),c=n.n(o),l=(n(503),n(7)),u=(n(504),n(505),n(1)),s=n(279),i=n(26),m=n(495),d=n(38),f=n(6),b=n(3),p=n.n(b),g=n(14),E=n(37),v=n(11),h=n(20);function j(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(a.useState)({loading:!1,tokenName:"",maximum:0}),s=Object(l.a)(c,2),i=s[0],m=s[1],d=function(e){m(Object(f.a)({},i,Object(E.a)({},e.target.name,e.target.value)))};return r.a.createElement(u.Modal,{show:t,onClose:n},r.a.createElement(u.Modal.Card,{style:{backgroundColor:"white"}},r.a.createElement(u.Modal.Card.Head,null,r.a.createElement(u.Modal.Card.Title,null,"Establish Token")),r.a.createElement(u.Modal.Card.Body,null,r.a.createElement(u.Media,null,i.loading?r.a.createElement(u.Loader,null):r.a.createElement(u.Media.Item,null,r.a.createElement(u.Content,null,r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Token Name"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{value:i.tokenName,onChange:d,name:"tokenName",placeholder:"Token Name"}))),r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Maximum Mint"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{type:"number",value:i.maximum.toString(),onChange:d,name:"maximum",placeholder:"Maximum Mint"})),r.a.createElement(u.Form.Help,null,"Leave as 0 to allow unlimited minting")),r.a.createElement(u.Form.Field,{kind:"group"},r.a.createElement(u.Button,{color:"primary",onClick:function(){m(Object(f.a)({},i,{loading:!0})),function(){var e=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(o,[Object(v.establishTokenTransaction)(i.tokenName,i.maximum)]);case 2:m(Object(f.a)({},i,{loading:!1,tokenName:"",maximum:0})),n();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Establish"),r.a.createElement(u.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var O=n(52);function w(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,s=Object(a.useContext)(i.b),m=Object(l.a)(s,2)[1],d={loading:!1,tokenName:"",destination:"",amount:"",destinationError:"",amountError:""},b=Object(a.useState)(d),j=Object(l.a)(b,2),w=j[0],k=j[1],x=function(){return""!==w.destinationError},y=function(){return""!==w.amountError},T=function(e){k(Object(f.a)({},w,Object(E.a)({},e.target.name,e.target.value)))},C=Object.keys(c).map((function(e){return r.a.createElement("option",{key:e,value:e},e)}));return r.a.createElement(u.Modal,{show:t,onClose:n},r.a.createElement(u.Modal.Card,{style:{backgroundColor:"white"}},r.a.createElement(u.Modal.Card.Head,null,r.a.createElement(u.Modal.Card.Title,null,"Send Token")),r.a.createElement(u.Modal.Card.Body,null,r.a.createElement(u.Media,null,w.loading?r.a.createElement(u.Loader,null):r.a.createElement(u.Media.Item,null,r.a.createElement(u.Content,null,r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Token Name"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Select,{onChange:T,value:w.tokenName,name:"tokenName"},r.a.createElement("option",{value:""}),C))),r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Destination"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{color:x()?"danger":"info",value:w.destination,onChange:T,name:"destination",placeholder:"Where to send"})),x()&&r.a.createElement(u.Form.Help,{color:"danger"},w.destinationError)),r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Amount"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{color:y()?"danger":"info",type:"number",value:w.amount,onChange:T,name:"amount",placeholder:"Amount to send"})),y()&&r.a.createElement(u.Form.Help,{color:"danger"},w.amountError)),r.a.createElement(u.Form.Field,{kind:"group"},r.a.createElement(u.Button,{color:"primary",onClick:function(){k(Object(f.a)({},w,{loading:!0,destinationError:"",amountError:""})),function(){var e=Object(g.a)(p.a.mark((function e(){var t,a,r,c,l,u,s,b,g,E,j,x,y,T,C;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sending: ",w),e.next=3,Object(h.a)();case 3:return t=e.sent,e.next=6,o.resolve("/tree/_tupelo/tokens/"+w.tokenName);case 6:if(a=e.sent,r=a.value.balance,!(parseInt(w.amount,10)>r)){e.next=11;break}return k((function(e){return Object(f.a)({},e,{amountError:"That's too much. You don't have that",loading:!1})})),e.abrupt("return");case 11:return e.prev=11,e.next=14,Object(O.a)(w.destination);case 14:c=e.sent,e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(11),"not found"!==e.t0){e.next=22;break}return k((function(e){return Object(f.a)({},e,{destinationError:"User not found",loading:!1})})),e.abrupt("return");case 22:throw e.t0;case 23:return e.next=25,v.EcdsaKey.generate();case 25:return l=e.sent,e.next=28,v.ChainTree.newEmptyTree(t.blockservice,l);case 28:return u=e.sent,e.next=31,o.id();case 31:return s=e.sent,e.next=34,c.id();case 34:return b=e.sent,e.next=37,u.id();case 37:if(g=e.sent,null!==s&&null!==b&&null!==g){e.next=40;break}throw new Error("error getting userdid, destdid or ephemeralDID");case 40:return console.log("ephemeralDID: ",g),e.next=43,o.resolve("tree/_tupelo/authentications");case 43:return E=e.sent,e.next=46,c.resolve("tree/_tupelo/authentications");case 46:return j=e.sent,x=s+"->"+b+Math.random().toString(),console.log("sending token to ephemeral"),y=Object(v.sendTokenTransaction)(x,w.tokenName,parseInt(w.amount,10),g),console.log("send tx: ",y.toObject()),e.next=53,t.sendTokenAndGetPayload(o,y);case 53:return T=e.sent,console.log("receiving on ephemeral, payload: ",T.toObject()),C=Object(v.receiveTokenTransactionFromPayload)(T),console.log("receiveTx: ",C.toObject()),e.next=59,Object(h.b)(u,[Object(v.setOwnershipTransaction)(E.value.concat(j.value)),C]);case 59:console.log("done"),k(d),n(),m({type:i.a.message,message:{title:"Sent "+w.amount+" token to user: "+w.destination,body:"Ask "+w.destination+" to use this DID in their receive token: \n"+g}});case 63:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(){return e.apply(this,arguments)}}()()}},"Send"),r.a.createElement(u.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function k(e){var t=e.show,n=e.onClose,o=e.userTree,c=e.tokens,s=Object(a.useState)({loading:!1,tokenName:"",amount:0}),i=Object(l.a)(s,2),m=i[0],d=i[1],b=function(e){d(Object(f.a)({},m,Object(E.a)({},e.target.name,e.target.value)))},j=Object.keys(c).map((function(e){return r.a.createElement("option",{key:e,value:e},e)}));return r.a.createElement(u.Modal,{show:t,onClose:n},r.a.createElement(u.Modal.Card,{style:{backgroundColor:"white"}},r.a.createElement(u.Modal.Card.Head,null,r.a.createElement(u.Modal.Card.Title,null,"Mint Token")),r.a.createElement(u.Modal.Card.Body,null,r.a.createElement(u.Media,null,m.loading?r.a.createElement(u.Loader,null):r.a.createElement(u.Media.Item,null,r.a.createElement(u.Content,null,r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Token Name"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Select,{onChange:b,value:m.tokenName,name:"tokenName"},r.a.createElement("option",{value:""}),j))),r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Amount"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{type:"number",value:m.amount.toString(),onChange:b,name:"amount",placeholder:"Amount to Mint"}))),r.a.createElement(u.Form.Field,{kind:"group"},r.a.createElement(u.Button,{color:"primary",onClick:function(){d(Object(f.a)({},m,{loading:!0})),function(){var e=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.b)(o,[Object(v.mintTokenTransaction)(m.tokenName,m.amount)]);case 2:d(Object(f.a)({},m,{loading:!1,tokenName:"",amount:0})),n();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Mint"),r.a.createElement(u.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}var x=n(128),y=n(182),T=n(9),C=n.n(T)()("util:syncher"),F=function(){function e(t){Object(x.a)(this,e),this.queue=void 0,this.started=void 0,this.name=void 0,this.started=!1,this.queue=[],this.name=t}return Object(y.a)(e,[{key:"run",value:function(){var e=Object(g.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.queue.pop())){e.next=5;break}return C(this.name," stopping syncher"),this.started=!1,e.abrupt("return");case 5:return e.prev=5,C(this.name," run fn",t.fn.toString()),e.next=9,t.fn();case 9:n=e.sent,C(this.name," finish fn"),t.res(n),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),C(this.name," rejecting: ",e.t0),t.rej(e.t0);case 18:this.queue.length>0?(C(this.name,"syncher queueing another"),this.run()):this.started=!1;case 19:case"end":return e.stop()}}),e,this,[[5,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;return new Promise((function(n,a){if(t.queue.push({fn:e,res:n,rej:a}),!t.started)return C(t.name," not started, starting"),t.started=!0,void t.run();C(t.name," run already started")}))}}]),e}();function D(e){var t=e.show,n=e.onClose,o=e.userTree,c=Object(a.useState)({loading:!1,did:""}),s=Object(l.a)(c,2),i=s[0],m=s[1];return r.a.createElement(u.Modal,{show:t,onClose:n},r.a.createElement(u.Modal.Card,{style:{backgroundColor:"white"}},r.a.createElement(u.Modal.Card.Head,null,r.a.createElement(u.Modal.Card.Title,null,"Receive Token")),r.a.createElement(u.Modal.Card.Body,null,r.a.createElement(u.Media,null,i.loading?r.a.createElement(u.Loader,null):r.a.createElement(u.Media.Item,null,r.a.createElement(u.Content,null,r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"DID"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{value:i.did,onChange:function(e){m(Object(f.a)({},i,Object(E.a)({},e.target.name,e.target.value)))},name:"did",placeholder:"DID of tokens"})),r.a.createElement(u.Form.Help,null,"This is the code that begins with 'did:tupelo:' that the sender has from the wallet.\xe5")),r.a.createElement(u.Form.Field,{kind:"group"},r.a.createElement(u.Button,{color:"primary",onClick:function(){m(Object(f.a)({},i,{loading:!0})),function(){var e=Object(g.a)(p.a.mark((function e(){var t,a,r,c,l,u,s,d,b;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)();case 2:return t=e.sent,e.next=5,o.id();case 5:if(null!==(a=e.sent)){e.next=8;break}throw new Error("user tree had null id");case 8:return e.next=10,t.getTip(i.did);case 10:return r=e.sent,c=new v.ChainTree({store:t.blockservice,tip:r,key:o.key}),e.next=14,c.resolve("/tree/_tupelo/tokens");case 14:return l=e.sent,e.next=17,Promise.all(Object.keys(l.value||{}).map(function(){var e=Object(g.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.resolve("/tree/_tupelo/tokens/"+t);case 2:return n=e.sent,e.abrupt("return",{name:t,balance:n.value.balance});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:return u=e.sent,s=new F,e.next=21,Promise.all(u.map((function(e){return s.send((function(){return t.sendTokenAndGetPayload(c,Object(v.sendTokenTransaction)("uuid"+Math.random().toString(),e.name,e.balance,a))}))})));case 21:return d=e.sent,b=d.map((function(e){return Object(v.receiveTokenTransactionFromPayload)(e)})),e.next=25,Object(h.b)(o,b);case 25:m((function(e){return Object(f.a)({},e,{loading:!1,did:""})})),n();case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Receive"),r.a.createElement(u.Button,{text:!0,onClick:function(){n()}},"cancel"))))))))}function S(e){var t=Object(a.useState)({loading:!0,tokens:{},showEstablishModal:!1,showMintModal:!1,showSendModal:!1,showReceiveModal:!1,modifiedAt:0}),n=Object(l.a)(t,2),o=n[0],c=n[1],s=Object(a.useContext)(i.b),m=Object(l.a)(s,1)[0];if(Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==m.userTree){e.next=2;break}throw new Error("user tree must be defined");case 2:return e.prev=2,e.next=5,m.userTree.resolve("/tree/_tupelo/tokens");case 5:t=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("e: ",e.t0),c((function(e){return Object(f.a)({},e,{tokens:{},loading:!1})}));case 12:console.log("tokens resp: ",t),c((function(e){return Object(f.a)({},e,{tokens:t.value||{},loading:!1})}));case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();console.log("loading tokens"),e()}),[m.userTree,o.modifiedAt]),!m.userTree)return r.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}});if(o.loading)return r.a.createElement(u.Loader,null);var b=Object.keys(o.tokens).map((function(e){if(void 0===m.userTree)throw new Error("undefined user tree!");return r.a.createElement(M,{key:e,modifiedAt:o.modifiedAt,tree:m.userTree,tokenName:e})})),E=function(){console.log("setting modifiedAt"),c((function(e){return Object(f.a)({},e,{modifiedAt:Date.now()})}))};return r.a.createElement("div",null,r.a.createElement(j,{userTree:m.userTree,show:o.showEstablishModal,onClose:function(){E(),c(Object(f.a)({},o,{showEstablishModal:!1}))}}),r.a.createElement(k,{tokens:o.tokens,userTree:m.userTree,show:o.showMintModal,onClose:function(){E(),c(Object(f.a)({},o,{showMintModal:!1}))}}),r.a.createElement(w,{tokens:o.tokens,userTree:m.userTree,show:o.showSendModal,onClose:function(){E(),c(Object(f.a)({},o,{showSendModal:!1}))}}),r.a.createElement(D,{userTree:m.userTree,show:o.showReceiveModal,onClose:function(){E(),c(Object(f.a)({},o,{showReceiveModal:!1}))}}),r.a.createElement(u.Level,null,r.a.createElement(u.Level.Side,{align:"left"},r.a.createElement(u.Level.Item,null,r.a.createElement(u.Button,{onClick:function(){c(Object(f.a)({},o,{showSendModal:!0}))}},"Send Token")),r.a.createElement(u.Level.Item,null,r.a.createElement(u.Button,{onClick:function(){c(Object(f.a)({},o,{showReceiveModal:!0}))}},"Receive Token")))),r.a.createElement(u.Table,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Balance"),r.a.createElement("th",null,"Max"))),r.a.createElement("tbody",null,b)),r.a.createElement(u.Level,null,r.a.createElement(u.Level.Side,{align:"left"},r.a.createElement(u.Level.Item,null,r.a.createElement(u.Button,{onClick:function(){c(Object(f.a)({},o,{showEstablishModal:!0}))}},"Establish Token")),r.a.createElement(u.Level.Item,null,r.a.createElement(u.Button,{onClick:function(){c(Object(f.a)({},o,{showMintModal:!0}))}},"Mint Token")))))}var M=function(e){var t=e.tree,n=e.tokenName,o=e.modifiedAt,c=Object(a.useState)({balance:0,max:null,loading:!0}),s=Object(l.a)(c,2),i=s[0],m=s[1];return Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(p.a.mark((function e(){var a,r,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/tree/_tupelo/tokens/"+n,e.next=3,t.resolve(a);case 3:if(r=e.sent,console.log("tokenInfoResp ",a,r),!r.value.monetaryPolicy){e.next=10;break}return e.next=8,t.resolve(a+"/monetaryPolicy");case 8:o=e.sent,m((function(e){return Object(f.a)({},e,{max:o.value.maximum})}));case 10:m((function(e){return Object(f.a)({},e,{balance:r.value.balance,loading:!1})}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();console.log("loading tokenRow"),e()}),[t,n,o]),r.a.createElement("tr",null,r.a.createElement("td",null,n),r.a.createElement("td",null,i.loading?r.a.createElement(u.Loader,null):i.balance),r.a.createElement("td",null,i.loading?r.a.createElement(u.Loader,null):i.max))},L=n(493),I=n(494);function N(e){var t=Object(a.useState)({loading:!0,entries:{},modifiedAt:0}),n=Object(l.a)(t,2),o=n[0],c=n[1],s=Object(a.useContext)(i.b),m=Object(l.a)(s,1)[0];if(Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==m.userTree){e.next=2;break}throw new Error("user tree must be defined");case 2:return e.prev=2,e.next=5,m.userTree.resolveData("/_tns");case 5:t=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("e: ",e.t0),c((function(e){return Object(f.a)({},e,{entries:{},loading:!1})}));case 12:console.log("entries resp: ",t),c((function(e){return Object(f.a)({},e,{entries:t.value||{},loading:!1})}));case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();console.log("loading TNS entries"),e()}),[m.userTree,o.modifiedAt]),!m.userTree)return r.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}});if(o.loading)return r.a.createElement(u.Loader,null);var b=Object.keys(o.entries).map((function(e){if(void 0===m.userTree)throw new Error("user tree must be defined");return r.a.createElement(A,{key:e,modifiedAt:o.modifiedAt,tree:m.userTree,entryName:e})}));return r.a.createElement("div",null,r.a.createElement(P,{userTree:m.userTree,entryChanged:function(){return c(Object(f.a)({},o,{modifiedAt:Date.now()}))}}),r.a.createElement(u.Table,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Value"))),r.a.createElement("tbody",null,b)))}var B,A=function(e){var t=e.tree,n=e.entryName,o=e.modifiedAt,c=Object(a.useState)({name:"",pointer:"",loading:!0}),s=Object(l.a)(c,2),i=s[0],m=s[1];return Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(p.a.mark((function e(){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/_tns/"+n,e.next=3,t.resolveData(a);case 3:r=e.sent,console.log("entryInfoResp: ",a,r),m((function(e){return Object(f.a)({},e,{name:n,pointer:r.value,loading:!1})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();console.log("loading entryRow"),e()}),[t,n,o]),r.a.createElement("tr",null,r.a.createElement("td",null,n),r.a.createElement("td",null,i.loading?r.a.createElement(u.Loader,null):i.pointer))},P=function(e){var t=e.userTree,n=e.entryChanged,o=Object(a.useState)({loading:!1,entryName:"",pointer:""}),c=Object(l.a)(o,2),s=c[0],i=c[1],m=function(e){i(Object(f.a)({},s,Object(E.a)({},e.target.name,e.target.value)))};return r.a.createElement(u.Box,null,r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Name"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{value:s.entryName,onChange:m,name:"entryName",placeholder:"Name"}))),r.a.createElement(u.Form.Field,null,r.a.createElement(u.Form.Label,null,"Value"),r.a.createElement(u.Form.Control,null,r.a.createElement(u.Form.Input,{value:s.pointer,onChange:m,name:"pointer",placeholder:"Value"}))),r.a.createElement(u.Form.Field,{kind:"group"},r.a.createElement(u.Button,{color:"primary",onClick:function(){i(Object(f.a)({},s,{loading:!0})),function(){var e=Object(g.a)(p.a.mark((function e(){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.entryName,a=r.replace(".","/"),e.next=3,Object(h.b)(t,[Object(v.setDataTransaction)("/_tns/"+a,s.pointer)]);case 3:i(Object(f.a)({},s,{loading:!1,entryName:"",pointer:""})),n();case 5:case"end":return e.stop()}var r}),e)})));return function(){return e.apply(this,arguments)}}()()}},"Set")))};function H(e){var t=Object(a.useState)({currentTab:B.tokens}),n=Object(l.a)(t,2),o=n[0],c=n[1],s=Object(a.useContext)(i.b),m=Object(l.a)(s,1)[0],b=function(e){var t=e.target.innerText.toLowerCase();c(Object(f.a)({},o,{currentTab:B[t]}))};return m.userTree?r.a.createElement(u.Container,null,r.a.createElement(u.Tabs,{type:"boxed"},r.a.createElement(u.Tabs.Tab,{onClick:b,active:o.currentTab===B.tokens},"Tokens"),r.a.createElement(u.Tabs.Tab,{onClick:b,active:o.currentTab===B.objects},"Objects"),r.a.createElement(u.Tabs.Tab,{onClick:b,active:o.currentTab===B.creator},"Creator"),r.a.createElement(u.Tabs.Tab,{onClick:b,active:o.currentTab===B.tns},"TNS")),function(e){if(void 0===m.userTree)throw new Error("can't get page content without a usertree");switch(e){case B.tokens:return r.a.createElement(S,null);case B.creator:return r.a.createElement(L.a,{userTree:m.userTree});case B.objects:return r.a.createElement(I.a,null);case B.tns:return r.a.createElement(N,null);default:throw new Error("unrecognized tab: "+e)}}(o.currentTab)):r.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}})}function K(){var e=Object(a.useState)({username:"",chaintreeDataPath:"",tree:void 0,target:""}),t=Object(l.a)(e,2),n=t[0],o=t[1],c="tupelo.me";console.log("walletHostname: ".concat(c));var s=c.split(".").reverse();return Object(a.useEffect)((function(){(function(){var e=Object(g.a)(p.a.mark((function e(){var t,a,r,c,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===n.target){e.next=2;break}return e.abrupt("return");case 2:return t=window.location.hostname.split(".").reverse(),console.log("hostnameComponents: ".concat(t)),c=!0,s.forEach((function(e,n){t[n]!==e&&(c=!1)})),c?(a=t[s.length],r=t.slice(s.length+1).reverse().join("/")):(a=t.slice(0,2).reverse().join("."),r=t.slice(2).reverse().join("/")),e.prev=7,console.log("getting tree for username ".concat(a)),e.next=11,Object(O.a)(a);case 11:l=e.sent,o((function(e){return Object(f.a)({},e,{username:a,chaintreeDataPath:r,tree:l})})),e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(7),e.abrupt("return");case 18:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(){return e.apply(this,arguments)}})()()})),Object(a.useEffect)((function(){var e=function(){var e=Object(g.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===n&&(n="@"),console.log("looking up TNS record at ".concat(n)),e.next=4,t.resolveData("".concat("/_tns","/").concat(n));case 4:a=e.sent,r="".concat("https://ipfs.io").concat(a.value),o((function(e){return console.log("setting state.target to ".concat(r)),Object(f.a)({},e,{target:r})}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();void 0!==n.tree&&""===n.target&&e(n.tree,n.chaintreeDataPath)}),[n.tree,n.chaintreeDataPath]),Object(a.useEffect)((function(){""!==n.target&&(console.log("Setting location to ".concat(n.target)),window.location.href=n.target)}),[n.target]),r.a.createElement("div",null,r.a.createElement("h3",null,"Welcome to the ",c," Tupelo Naming Service gateway."),r.a.createElement("p",null,"Redirecting to ",""===n.target?r.a.createElement("span",null,"... ",r.a.createElement(u.Loader,null)):n.target))}function _(){var e=Object(a.useContext)(i.b),t=Object(l.a)(e,1)[0].messages.map((function(e){return r.a.createElement(R,{message:e})}));return r.a.createElement(u.Container,null,r.a.createElement("ol",{style:{listStyleType:"none"}},t))}!function(e){e[e.tokens=0]="tokens",e[e.objects=1]="objects",e[e.creator=2]="creator",e[e.tns=3]="tns"}(B||(B={}));var R=function(e){var t=e.message,n=Object(a.useContext)(i.b),o=Object(l.a)(n,2)[1];if(void 0===t.id)throw new Error("a message must have an id when it's in the list");return r.a.createElement("li",{key:t.id},r.a.createElement(u.Message,{color:"info"},r.a.createElement(u.Message.Header,null,t.title,r.a.createElement(u.Button,{remove:!0,onClick:function(){o({type:i.a.removeMessage,id:t.id})}})),r.a.createElement(u.Message.Body,{style:{whiteSpace:"pre"}},t.body)))},U=function(){var e=Object(a.useContext)(i.b);return Object(l.a)(e,1)[0].loading>0?r.a.createElement(u.Section,null,r.a.createElement(u.Columns,{className:"is-desktop"},r.a.createElement(u.Loader,{style:{height:100,width:100}}))):"tupelo.me"===window.location.hostname?r.a.createElement("div",null,r.a.createElement(_,null),r.a.createElement(m.a,null,r.a.createElement(d.d,null,r.a.createElement(d.b,{path:"/login"},r.a.createElement(s.a,null)),r.a.createElement(d.b,{path:"/wallet"},r.a.createElement(H,null)),r.a.createElement(d.b,null,r.a.createElement(s.a,null))))):r.a.createElement(K,null)},V=function(){var e=Object(a.useContext)(i.b),t=Object(l.a)(e,1)[0];return r.a.createElement(u.Navbar,{transparent:!1},r.a.createElement(u.Navbar.Brand,null,r.a.createElement("img",{src:n(1182),alt:"Tupelo"})),r.a.createElement(u.Navbar.Container,{position:"end"},t&&t.username&&r.a.createElement("p",null,"Wallet of ",t.username)))},W=function(){return r.a.createElement(i.c,null,r.a.createElement(u.Container,null,r.a.createElement(V,null)),r.a.createElement(u.Container,null,r.a.createElement(u.Section,null,r.a.createElement(U,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=window.location;"https:"!==q.protocol&&(window.location.href=q.href.replace("http://","https://")),c.a.render(r.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},20:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f}));var a,r=n(3),o=n.n(r),c=n(14),l=n(11),u=n(30),s=n.n(u),i=n(9),m=n.n(i)()("appcommunity");function d(){return m("getAppCommunity"),void 0!==a?a:a=new Promise(function(){var e=Object(c.a)(o.a.mark((function e(t,n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0="production",e.next="production"===e.t0?3:8;break;case 3:return m("using production community"),e.next=6,l.Community.getDefault();case 6:return a=e.sent,e.abrupt("break",13);case 8:return m("using development community"),e.next=11,l.Community.fromNotaryGroupToml('\nid = "tupelolocal"\nBootstrapAddresses = [\n    "/ip4/127.0.0.1/tcp/34001/ipfs/16Uiu2HAm3TGSEKEjagcCojSJeaT5rypaeJMKejijvYSnAjviWwV5",\n    "/ip4/127.0.0.1/tcp/50000/ws/ipfs/16Uiu2HAm4hjC7zZTSN5KAp187vn52bZMsC8VaVdtrci7HD4aZcU7",\n]\n[[signers]]\nVerKeyHex = "0x15796b266a7d6b7c6b29c5bf97ad376fe8457e4d56bb0612ec8703c65ca7b6bb5dca004d55f5238d7764cd100c9e9cac3c5abce902bae8a5f9c29de716a145595b071b1b7038a48b4f6f88e7664b38c02062f64b3ceb499e4cbb82361457dcd731f5b48901871e7fd56a9c91ab3e06d3f7cb27288962686d9a05e02c1482f01f"\nDestKeyHex = "0x04f6dee3f7da1da58afd6ee58ea6b858fb67664fc6e2240bb6e3a75c0e1db9bbef5f413c8604bb864513d3cf27eca60b539b048b2a08f8799570c14dfb73f3f391"\n\n[[signers]]\nVerKeyHex = "0x7be8c92c8c295ef3e97be28f469f5f94d10ee7db4d202776bee5cf55c62d508a0c3550a19342d768ff073c0798ce003646df586ef588a9e9443a0ca86a234ed15150dc98ecc3f1071649fca03426f1c8c215a90752f51faa3e2e788e1dae2e9e5cf87c1ca4239a0949a0ba6ea09c061a538372cc4230dedafae929b170ad7704"\nDestKeyHex = "0x0438b196bddb9c3ec395b8ccb07bdab44ec768c084e7141b09ac5638d47fffbd5e7b7623f499a2e714e31464a356a0e30ad7c93045b6cd9957b45e957cc15dcb99"\n\n[[signers]]\nVerKeyHex = "0x88aefad94805db01cacaf190f47bc9e40f584b5085c651da168ac4034d570b4750bf7b23803d204e483e407a5ca34ee7f7a434733346451cf3f5d26c0d11e5ac45398a03fbba2d3b0dfc21cdf14615430cea394bd9423d8527eaa82a96aa6d20655724d99770ee3488b6537d6be143b84b21ad5ee12c190048757fe453313fd2"\nDestKeyHex = "0x0468924bd1341b5cec1fed888aaf1e3caa94e7d0f13d4f4573b01b296374b9e710a58a7b40e7161c0bcf7fd41832441ca21076f3846e854c8d8c640f2469a552b1"\n');case 11:a=e.sent,l.Community.setDefault(a);case 13:t(a);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function f(e,t){return b.apply(this,arguments)}function b(){return(b=Object(c.a)(o.a.mark((function t(n,a){var r,c,l,u,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d();case 2:return r=t.sent,t.next=5,r.playTransactions(n,a);case 5:if(c=t.sent,void 0!==(l=c.getSignature())){t.next=9;break}throw new Error("undefined sig from response");case 9:return u=new s.a(e.from(l.getNewTip_asU8())),t.next=12,n.id();case 12:if(null!==(i=t.sent)){t.next=15;break}throw new Error("error getting ID, was null");case 15:return t.next=17,p(i,u);case 17:return t.abrupt("return",c);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(e,t){return new Promise((function(n,a){m("waiting for community on ",e);var r=0,l=function(){var u=Object(c.a)(o.a.mark((function c(){var u,s;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d();case 2:return u=o.sent,m("waitForCommunityTip: awaitng nextUpdate"),o.next=6,u.nextUpdate();case 6:return m("waitForCommunityTip: getTip"),o.prev=7,o.next=10,u.getTip(e);case 10:s=o.sent,o.next=19;break;case 13:if(o.prev=13,o.t0=o.catch(7),"not found"!==o.t0){o.next=18;break}return setTimeout(l,200),o.abrupt("return");case 18:throw new Error(o.t0);case 19:if(!t.equals(s)){o.next=23;break}return m("tips matched",e),n(),o.abrupt("return");case 23:if(!(r>60)){o.next=27;break}return m("waitForCommunityTip: rejecting timeout ",e),a(new Error("timeout error, over 30s")),o.abrupt("return");case 27:r++,m("tips did not match, retrying",e),setTimeout(l,500);case 30:case"end":return o.stop()}}),c,null,[[7,13]])})));return function(){return u.apply(this,arguments)}}();l()}))}}).call(this,n(2).Buffer)},213:function(e,t){},26:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return h}));var a,r=n(3),o=n.n(r),c=n(14),l=n(7),u=n(183),s=n(6),i=n(0),m=n.n(i),d=n(11),f=n(20),b=n(52);if(window){var p=window.location.pathname;console.log("subDirectory ",p),"/"!==p&&(console.log("setting wasmpath to: ",p+"tupelo.wasm"),Go.setWasmPath(p+"tupelo.wasm"))}function g(e,t){var n;switch(t.type){case a.loading:return Object(s.a)({},e,{loading:e.loading+1});case a.stopLoading:return Object(s.a)({},e,{loading:e.loading-1});case a.login:return n=t,Object(s.a)({},e,{userTree:n.userTree,username:n.username,did:n.did});case a.setDID:return Object(s.a)({},e,{userDid:t.did});case a.setUsername:return Object(s.a)({},e,{username:t.username});case a.logout:return sessionStorage.removeItem("userDid"),sessionStorage.removeItem("userKey"),Object(s.a)({},E,{loading:0});case a.message:var r=t.message;return r.id=(new Date).toString()+"-"+r.title+Math.random().toString(),Object(s.a)({},e,{messages:[].concat(Object(u.a)(e.messages),[r])});case a.removeMessage:for(var o=t.id,c=-1,l=e.messages.length-1;l>=0;l--)if(e.messages[l].id===o){c=l;break}return-1===c?e:Object(s.a)({},e,{messages:[].concat(Object(u.a)(e.messages.slice(0,c)),Object(u.a)(e.messages.slice(c+1)))});default:throw new Error("unkown type: "+t.type)}}!function(e){e[e.loading=0]="loading",e[e.stopLoading=1]="stopLoading",e[e.login=2]="login",e[e.setDID=3]="setDID",e[e.removeMessage=4]="removeMessage",e[e.message=5]="message",e[e.logout=6]="logout",e[e.setUsername=7]="setUsername"}(a||(a={}));var E={loading:1,messages:[]},v=Object(i.createContext)([E,function(){}]),h=function(t){var n=t.children,r=Object(i.useState)(!0),u=Object(l.a)(r,2),s=u[0],p=u[1],h=Object(i.useReducer)(g,E),j=Object(l.a)(h,2),O=j[0],w=j[1];return Object(i.useEffect)((function(){if(s){p(!1),Object(f.a)();var t=sessionStorage.getItem("userDid"),n=sessionStorage.getItem("userKey");t&&n?function(){var r=Object(c.a)(o.a.mark((function r(){var c,l,u,s,i;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&n){r.next=2;break}throw new Error("no did or no userKey");case 2:return r.next=4,Object(f.a)();case 4:return c=r.sent,r.prev=5,r.next=8,c.getTip(t);case 8:l=r.sent,r.next=17;break;case 11:if(r.prev=11,r.t0=r.catch(5),"not found"!==r.t0){r.next=16;break}return w({type:a.logout}),r.abrupt("return");case 16:throw r.t0;case 17:return r.next=19,d.EcdsaKey.fromBytes(e.from(n,"base64"));case 19:return u=r.sent,s=new d.ChainTree({key:u,tip:l,store:c.blockservice}),r.next=23,s.resolveData(b.c);case 23:i=r.sent.value,console.log("logging in from storage: ",i," did: ",t),w({type:a.login,userTree:s,did:t,username:i}),w({type:a.stopLoading});case 27:case"end":return r.stop()}}),r,null,[[5,11]])})));return function(){return r.apply(this,arguments)}}()():(console.log("stopping loading"),w({type:a.stopLoading}))}!O.userDid&&O.userTree&&O.userTree.id().then((function(e){w({type:a.setDID,did:e})})),O.userTree&&O.userDid&&O.userTree.key&&O.userTree.key.privateKey&&(sessionStorage.setItem("userDid",O.userDid),sessionStorage.setItem("userKey",e.from(O.userTree.key.privateKey).toString("base64"))),console.log({newState:O})}),[O,s]),m.a.createElement(v.Provider,{value:[O,w]},n)}}).call(this,n(2).Buffer)},279:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return T}));var a,r=n(7),o=n(6),c=n(3),l=n.n(c),u=n(14),s=n(0),i=n.n(s),m=n(1),d=n(20),f=n(11),b=n(38),p=n(26),g=n(52);!function(e){e[e.loginFormType=0]="loginFormType",e[e.passwordFormType=1]="passwordFormType",e[e.userTree=2]="userTree",e[e.registering=3]="registering",e[e.loggingIn=4]="loggingIn"}(a||(a={}));var E,v={loading:!1,username:"",password:"",loadingText:""},h=function(e,t){var n=function(){var n=Object(u.a)(l.a.mark((function n(){var r,o,c,u,s,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(d.a)();case 2:if(r=n.sent,o=e.username){n.next=6;break}return n.abrupt("return");case 6:return console.log("actually checking: ",o),n.next=9,Object(g.b)(o);case 9:return c=n.sent,n.next=12,f.Tupelo.ecdsaPubkeyToDid(c.publicKey);case 12:return u=n.sent,i=void 0,n.prev=14,n.next=17,r.getTip(u);case 17:s=n.sent,n.next=23;break;case 20:n.prev=20,n.t0=n.catch(14),n.t0;case 23:void 0!==s&&(i=new f.ChainTree({store:r.blockservice,tip:s})),t({type:a.userTree,username:o,tree:i,dispatch:t}),E=void 0;case 26:case"end":return n.stop()}}),n,null,[[14,20]])})));return function(){return n.apply(this,arguments)}}();clearTimeout(E),E=setTimeout(n,150)};function j(e,t){switch(t.type){case a.loginFormType:var n=t.username;return h(e,t.dispatch),Object(o.a)({},e,{loading:!0,loginText:"Checking for username availability",username:n});case a.userTree:var r=t;return console.log("user tree received: ",r.username," state: ",e.username),r.username!==e.username?(h(e,r.dispatch),e):Object(o.a)({},e,{loading:!1,loadingText:"",userTree:t.tree});case a.passwordFormType:return Object(o.a)({},e,{password:t.password});case a.registering:return Object(o.a)({},e,{loading:!0,loadingText:"Registering your user"});case a.loggingIn:return Object(o.a)({},e,{loading:!0,loadingText:"Logging in"});default:throw new Error("unkown type: "+t.type)}}var O=function(e){return!e.loading&&e.username&&!e.userTree};function w(e){var t=e.state,n=e.onChange;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Username"),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{color:O(t)?"success":"info",type:"text",placeholder:"Username",value:t.username,onChange:n}),t.loading?i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-spinner fa-pulse"})):i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-user"}))),O(t)&&i.a.createElement(m.Form.Help,{color:"success"},"This username is available"))}function k(e){var t=e.name,n=e.value,a=e.onChange,r=e.error;return i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,t),i.a.createElement(m.Form.Control,{iconLeft:!0},i.a.createElement(m.Form.Input,{className:r?"animated pulse faster":"",color:r?"danger":"info",type:"password",placeholder:"Password",value:n,onChange:a}),i.a.createElement(m.Icon,{align:"left"},i.a.createElement("span",{className:"fas fa-key"}))),r&&i.a.createElement(m.Form.Help,{color:"danger"},r))}function x(t){var n=t.state,a=(t.dispatch,t.onLogin),o=Object(s.useState)(""),c=Object(r.a)(o,2),d=c[0],b=c[1],p=Object(s.useState)(""),g=Object(r.a)(p,2),E=g[0],v=g[1],h=function(){var t=Object(u.a)(l.a.mark((function t(){var r,o,c,u,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n.userTree){t.next=2;break}throw new Error("must have a user tree to login");case 2:return r=n.userTree,o=n.username,t.next=6,f.EcdsaKey.passPhraseKey(e.from(d),e.from(o));case 6:return c=t.sent,t.next=9,f.Tupelo.ecdsaPubkeyToAddress(c.publicKey);case 9:return u=t.sent,t.next=12,r.resolve("tree/_tupelo/authentications");case 12:s=t.sent,s.value.includes(u)?(r.key=c,a(n.userTree)):v("invalid password");case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement(k,{error:E,name:"Password",value:d,onChange:function(e){v(""),b(e.target.value)}}),i.a.createElement(m.Button,{onClick:h},"Login"))}function y(t){var n=t.state,o=t.dispatch,c=t.onLogin,b=Object(s.useState)(""),p=Object(r.a)(b,2),E=p[0],v=p[1],h=Object(s.useState)(""),j=Object(r.a)(h,2),O=j[0],w=j[1],x=Object(s.useState)(""),y=Object(r.a)(x,2),T=y[0],C=y[1];return i.a.createElement("div",null,i.a.createElement(k,{error:T,name:"Password",value:E,onChange:function(e){C(""),v(e.target.value)}}),i.a.createElement(k,{error:T,name:"Confirm Password",value:O,onChange:function(e){C(""),w(e.target.value)}}),i.a.createElement(m.Button,{onClick:function(){E===O?(o({type:a.registering}),function(){var t=Object(u.a)(l.a.mark((function t(){var a,r,o,u,s,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.username,t.next=3,Object(g.b)(a);case 3:return r=t.sent,t.next=6,f.EcdsaKey.passPhraseKey(e.from(E),e.from(a));case 6:return o=t.sent,t.next=9,f.Tupelo.ecdsaPubkeyToAddress(o.publicKey);case 9:return u=t.sent,t.next=12,Object(d.a)();case 12:return s=t.sent,t.next=15,f.ChainTree.newEmptyTree(s.blockservice,r);case 15:return i=t.sent,console.log("playing transactions"),t.next=19,Object(d.b)(i,[Object(f.setOwnershipTransaction)([u]),Object(f.setDataTransaction)(g.c,a)]);case 19:i.key=o,c(i);case 21:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()):C("Passwords do not match")}},"Register"))}function T(e){var t=Object(s.useReducer)(j,v),n=Object(r.a)(t,2),o=n[0],c=n[1],d=Object(s.useState)(!1),f=Object(r.a)(d,2),g=f[0],E=f[1],h=Object(s.useContext)(p.b),O=Object(r.a)(h,2)[1],k=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.id();case 2:n=e.sent,O({type:p.a.login,userTree:t,username:o.username,did:n}),E(!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=(e.location&&e.location.state?e.location.state:{from:{pathname:"/wallet"}}).from;return g?i.a.createElement(b.a,{to:T}):i.a.createElement("div",null,i.a.createElement(m.Columns,{className:"is-desktop"},i.a.createElement(m.Columns.Column,{size:"half"},i.a.createElement(m.Heading,{className:"animated flipInX fast"},"Hello."),i.a.createElement(m.Heading,{subtitle:!0},"Find or create your wallet."))),i.a.createElement(m.Columns,{className:"is-desktop"},i.a.createElement(m.Columns.Column,{size:"half"},i.a.createElement(w,{state:o,onChange:function(e){c({type:a.loginFormType,username:e.target.value,dispatch:c})}}),o.loading&&o.username&&i.a.createElement("div",null,i.a.createElement(m.Loader,{style:{width:25,height:25}}),i.a.createElement("p",{className:"animated flipInX fast"},o.loadingText)),!o.loading&&o.username&&o.userTree&&i.a.createElement(x,{state:o,dispatch:c,onLogin:k}),!o.loading&&o.username&&!o.userTree&&i.a.createElement(y,{state:o,dispatch:c,onLogin:k}))))}}).call(this,n(2).Buffer)},493:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b}));var a=n(3),r=n.n(a),o=n(37),c=n(6),l=n(14),u=n(7),s=n(0),i=n.n(s),m=n(1),d=n(11),f=n(20);function b(t){var n=t.userTree,a={title:"",subtitle:"",content:"",imagePath:"",imageError:""},b=Object(s.useRef)(null),p=Object(s.useState)(a),g=Object(u.a)(p,2),E=g[0],v=g[1],h=Object(s.useState)(!1),j=Object(u.a)(h,2),O=j[0],w=j[1],k=function(){return""!==E.imagePath};function x(){return(x=Object(l.a)(r.a.mark((function t(){var o,l,s,i,m,p,g,h,j,O,x,y,T,C,F,D,S,M,L,I;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Object(c.a)({},E),void 0!==n.key){t.next=3;break}throw new Error("undefined userTree key");case 3:if(l=void 0,!k()){t.next=10;break}if(null!==b.current&&null!==b.current.files){t.next=7;break}throw new Error("undefined ref, even though imagePath set");case 7:s=new FileReader,i=b.current.files[0],l=new Promise((function(e,t){s.onload=function(){var n=s.result;n.byteLength>307200?t("Your image is too big, please limit to 300k"):e(n)},s.onerror=function(e){t(e)},s.readAsArrayBuffer(i)}));case 10:return m=d.EcdsaKey.generate(),p=Object(f.a)(),t.next=14,Promise.all([m,p]);case 14:return g=t.sent,h=Object(u.a)(g,2),j=h[0],O=h[1],x=d.ChainTree.newEmptyTree(O.blockservice,j),y=d.Tupelo.ecdsaPubkeyToAddress(n.key.publicKey),t.next=22,Promise.all([x,y]);case 22:return T=t.sent,C=Object(u.a)(T,2),F=C[0],D=C[1],t.next=28,F.id();case 28:if(null!==(S=t.sent)){t.next=31;break}throw new Error("unknown tree DID");case 31:if(M={title:o.title,subtitle:o.subtitle,content:o.content},!k()||void 0===l){t.next=47;break}return console.log("has image, getting the bits"),t.prev=34,t.t0=e,t.next=38,l;case 38:t.t1=t.sent,M.image=t.t0.from.call(t.t0,t.t1),t.next=47;break;case 42:return t.prev=42,t.t2=t.catch(34),v((function(e){return Object(c.a)({},e,{imageError:t.t2.toString()})})),w(!1),t.abrupt("return");case 47:return console.log("creating attrs: ",M),L=Object(f.b)(F,[Object(d.setDataTransaction)("/_wallet/attributes",M),Object(d.setOwnershipTransaction)([D])]),I=Object(f.b)(n,[Object(d.setDataTransaction)("/_wallet/nfts/"+S,Date.now())]),t.next=52,Promise.all([L,I]);case 52:v(a),w(!1);case 54:case"end":return t.stop()}}),t,null,[[34,42]])})))).apply(this,arguments)}var y=function(e){var t=e.target;console.log("setting ",t.name," to ",t.value),v(Object(c.a)({},E,Object(o.a)({},t.name,t.value)))};return i.a.createElement("div",null,O?i.a.createElement(m.Loader,null):i.a.createElement(m.Box,{style:{marginTop:"1em"}},i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Title"),i.a.createElement(m.Form.Control,null,i.a.createElement(m.Form.Input,{value:E.title,onChange:y,name:"title",placeholder:"title"}))),i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Subtitle"),i.a.createElement(m.Form.Control,null,i.a.createElement(m.Form.Input,{value:E.subtitle,onChange:y,name:"subtitle",placeholder:"subtitle"}))),i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Content"),i.a.createElement(m.Form.Control,null,i.a.createElement(m.Form.Input,{value:E.content,onChange:y,name:"content",placeholder:"content"}))),i.a.createElement(m.Form.Field,null,i.a.createElement(m.Form.Label,null,"Image (optional)"),i.a.createElement(m.Form.Control,null,i.a.createElement("input",{accept:"image/*",ref:b,onChange:y,name:"imagePath",type:"file"}),""!==E.imageError&&i.a.createElement(m.Form.Help,{color:"danger"},E.imageError))),i.a.createElement(m.Button,{onClick:function(){w(!0),function(){x.apply(this,arguments)}()}},"Create")))}}).call(this,n(2).Buffer)},494:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var a=n(37),r=n(496),o=n(497),c=n(3),l=n.n(c),u=n(6),s=n(14),i=n(7),m=n(0),d=n.n(m),f=n(1),b=n(26),p=n(11),g=n(20),E=n(52);function v(t){var n=t.did,a=t.onSend,c=t.userTree,v=Object(m.useContext)(b.b),h=Object(i.a)(v,2)[1],j=Object(m.useState)({loading:!0,tree:void 0,attrs:{},sending:!1,destination:"",destinationError:""}),O=Object(i.a)(j,2),w=O[0],k=O[1],x=function(){return""!==w.destinationError};Object(m.useEffect)((function(){(function(){var e=Object(s.a)(l.a.mark((function e(){var t,a,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)();case 2:return t=e.sent,e.next=5,t.getTip(n);case 5:return a=e.sent,r=new p.ChainTree({store:t.blockservice,tip:a}),e.next=9,r.resolveData("/_wallet/attributes");case 9:o=e.sent,console.log(o.value),k((function(e){return Object(u.a)({},e,{loading:!1,tree:r,attrs:o.value||{}})}));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[n]);return d.a.createElement(f.Card,null,w.attrs.image?d.a.createElement(f.Card.Image,{src:"data:image/*;base64,"+e.from(w.attrs.image).toString("base64")}):d.a.createElement(f.Card.Header,null,d.a.createElement(f.Card.Header.Title,null,w.attrs.title)),d.a.createElement(f.Card.Content,null,w.loading?d.a.createElement(f.Loader,null):d.a.createElement("div",null,d.a.createElement(f.Media,null,d.a.createElement(f.Media.Item,null,d.a.createElement(f.Heading,{size:4},w.attrs.title),d.a.createElement(f.Heading,{subtitle:!0,size:6},w.attrs.subtitle))),d.a.createElement(f.Content,null,w.attrs.content,d.a.createElement("pre",{style:{marginTop:"1em"}},n)))),d.a.createElement(f.Card.Footer,null,w.sending?d.a.createElement(f.Content,{style:{padding:"1em"}},d.a.createElement(f.Form.Field,null,d.a.createElement(f.Form.Label,null,"Destination Name"),d.a.createElement(f.Form.Control,null,d.a.createElement(f.Form.Input,{color:x()?"danger":"info",value:w.destination,onChange:function(e){k(Object(u.a)({},w,{destination:e.target.value}))},name:"nftdestination",placeholder:"Destination"})),x()&&d.a.createElement(f.Form.Help,{color:"danger"},w.destinationError)),d.a.createElement(f.Form.Field,{kind:"group"},d.a.createElement(f.Button,{color:"primary",onClick:function(){k(Object(u.a)({},w,{loading:!0,sending:!1,destinationError:""})),function(){var e=Object(s.a)(l.a.mark((function e(){var t,s,i,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==w.tree){e.next=2;break}throw new Error("card must have a tree to send");case 2:return e.prev=2,e.next=5,Object(E.a)(w.destination);case 5:t=e.sent,e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(2),"not found"!==e.t0){e.next=13;break}return k((function(e){return Object(u.a)({},e,{loading:!1,sending:!0,destinationError:"Unknown username"})})),e.abrupt("return");case 13:throw e.t0;case 14:return e.next=16,t.resolve("tree/_tupelo/authentications");case 16:return s=e.sent,w.tree.key=c.key,console.log("reassigning ",n," to: ",w.destination),e.next=21,Object(g.b)(w.tree,[Object(p.setOwnershipTransaction)(s.value)]);case 21:return console.log("remove did from nfts"),e.next=24,c.resolveData("/_wallet/nfts");case 24:return i=e.sent.value,i[n],m=Object(r.a)(i,[n].map(o.a)),e.next=28,Object(g.b)(c,[Object(p.setDataTransaction)("/_wallet/nfts",m)]);case 28:k((function(e){return Object(u.a)({},e,{sending:!1,loading:!1,destinationError:""})})),h({type:b.a.message,message:{title:"Sent an NFT to user: "+w.destination,body:"Ask "+w.destination+" to use this DID in their Add: \n"+n}}),a({did:n,tree:w.tree,destination:w.destination,dids:m});case 31:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}()()}},"Send"),d.a.createElement(f.Button,{text:!0,onClick:function(){k(Object(u.a)({},w,{sending:!1,destination:""}))}},"cancel"))):d.a.createElement(f.Card.Footer.Item,null,d.a.createElement(f.Button,{onClick:function(){k(Object(u.a)({},w,{sending:!0}))}},"Send"))))}function h(){var e=Object(m.useContext)(b.b),t=Object(i.a)(e,1)[0],n=Object(m.useState)({loading:!0,dids:{}}),r=Object(i.a)(n,2),o=r[0],c=r[1];if(void 0===t.userTree)throw new Error("must have a userTree to use ObjectWallet");var p=function(){var e=Object(s.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c((function(e){return Object(u.a)({},e,{dids:t.dids})}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(m.useEffect)((function(){var e=function(){var e=Object(s.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.userTree){e.next=2;break}throw new Error("user tree has to be defined");case 2:return e.next=4,t.userTree.resolveData("/_wallet/nfts");case 4:n=e.sent,c((function(e){return Object(u.a)({},e,{loading:!1,dids:n.value||{}})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.userTree&&e()}),[t.userTree]);var g=Object.keys(o.dids).map((function(e){if(void 0===t.userTree)throw new Error("must hae a user tree to list dids");return d.a.createElement(f.Columns.Column,{key:e,size:3},d.a.createElement(v,{userTree:t.userTree,onSend:p,did:e}))}));return d.a.createElement("div",null,d.a.createElement(f.Columns,null,o.loading&&d.a.createElement(f.Loader,null),g),d.a.createElement(j,{onAdd:function(e){c((function(t){return Object(u.a)({},t,{dids:Object(u.a)({},o.dids,Object(a.a)({},e,Date.now()))})}))},userTree:t.userTree}))}var j=function(e){var t=e.userTree,n=e.onAdd,a=Object(m.useState)({addOpen:!1,addDid:"",addLoading:!1}),r=Object(i.a)(a,2),o=r[0],c=r[1],b=function(){c(Object(u.a)({},o,{addLoading:!0}));var e=o.addDid;(function(){var a=Object(s.a)(l.a.mark((function a(){var r,s,i,m,d;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==t&&void 0!==t.key){a.next=2;break}throw new Error("user tree undfined");case 2:return a.next=4,Object(g.a)();case 4:return r=a.sent,a.next=7,r.getTip(e);case 7:return s=a.sent,i=new p.ChainTree({store:r.blockservice,tip:s}),a.next=11,p.Tupelo.ecdsaPubkeyToAddress(t.key.publicKey);case 11:return m=a.sent,a.next=14,i.resolve("tree/_tupelo/authentications");case 14:if(d=a.sent,!d.value.includes(m)){a.next=21;break}return a.next=19,Object(g.b)(t,[Object(p.setDataTransaction)("/_wallet/nfts/"+e,Date.now())]);case 19:n(e),c(Object(u.a)({},o,{addLoading:!1,addDid:""}));case 21:c(Object(u.a)({},o,{addLoading:!1,addDid:"",addOpen:!1}));case 22:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}})()()};return d.a.createElement("div",null,o.addOpen?d.a.createElement((function(){return o.addLoading?d.a.createElement(f.Loader,null):d.a.createElement(f.Box,null,d.a.createElement(f.Form.Field,null,d.a.createElement(f.Form.Label,null,"Add"),d.a.createElement(f.Form.Control,null,d.a.createElement(f.Form.Input,{value:o.addDid,onChange:function(e){c(Object(u.a)({},o,{addDid:e.target.value}))},name:"additionalDid",placeholder:"DID"}))),d.a.createElement(f.Form.Field,{kind:"group"},d.a.createElement(f.Button,{onClick:b,color:"primary"},"Add"),d.a.createElement(f.Button,{text:!0,onClick:function(){c((function(e){return Object(u.a)({},e,{addOpen:!1,addDid:""})}))}},"Cancel")))}),null):d.a.createElement(f.Button,{onClick:function(){c((function(e){return Object(u.a)({},e,{addOpen:!0})}))}},"Add"))}}).call(this,n(2).Buffer)},498:function(e,t,n){e.exports=n(1183)},503:function(e,t,n){},505:function(e,t,n){},52:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return d}));var a=n(3),r=n.n(a),o=n(14),c=n(11),l=n(20),u="/_wallet/username",s=e.from("_wallet-dev"),i=function(t){return c.EcdsaKey.passPhraseKey(e.from(t),s)},m=function(){var e=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t);case 2:return n=e.sent,e.abrupt("return",c.Tupelo.ecdsaPubkeyToDid(n.publicKey));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.a)();case 2:return n=e.sent,e.next=5,m(t);case 5:return a=e.sent,e.prev=6,e.next=9,n.getTip(a);case 9:o=e.sent,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),e.t0;case 15:return e.abrupt("return",new c.ChainTree({store:n.blockservice,tip:o}));case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(2).Buffer)},534:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=534},536:function(e,t){},538:function(e,t){},569:function(e,t){},570:function(e,t){},617:function(e,t){},715:function(e,t){}},[[498,1,2]]]);
//# sourceMappingURL=main.1da8cd26.chunk.js.map